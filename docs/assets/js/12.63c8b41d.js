(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{488:function(s,a,t){s.exports=t.p+"assets/img/image-20200526174934213.58b97c0c.png"},538:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"k3s-5-less-than-k8s"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#k3s-5-less-than-k8s"}},[s._v("#")]),s._v(" K3s -5   less  than k8s")]),s._v(" "),n("p",[s._v("轻量级Kubernetes发行版。易于安装，内存减半，所有二进制文件不到40mb。")]),s._v(" "),n("p",[s._v("使用于：")]),s._v(" "),n("ul",[n("li",[s._v("边缘计算-Edge")]),s._v(" "),n("li",[s._v("物联网-loT")]),s._v(" "),n("li",[s._v("CI")]),s._v(" "),n("li",[s._v("ARM")])]),s._v(" "),n("h3",{attrs:{id:"_1-what-is-this"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-what-is-this"}},[s._v("#")]),s._v(" 1. What is this?")]),s._v(" "),n("p",[s._v("k3s是完全兼容的Kubernetes发行版，有以下更改：")]),s._v(" "),n("ul",[n("li",[s._v("移除过时的功能、Alpha功能、非默认功能，这些功能在大多数Kubernetes集群中已不可用。")]),s._v(" "),n("li",[s._v("删除内置插件(比如云供应商插件和存储插件)，可用外部插件程序替换。")]),s._v(" "),n("li",[s._v("添加SQLite3作为默认的数据存储。etcd3仍然可用，但并非默认项。")]),s._v(" "),n("li",[s._v("包含在一个简单的启动程序当中，可以处理复杂的TLS和其他选项。")]),s._v(" "),n("li",[s._v("几乎没有操作系统依赖性（仅需要健全的内核和cgroup挂载）。k3s软件包所需的依赖：\n"),n("ul",[n("li",[s._v("containerd")]),s._v(" "),n("li",[s._v("Flannel")]),s._v(" "),n("li",[s._v("CoreDNS")]),s._v(" "),n("li",[s._v("CNI")]),s._v(" "),n("li",[s._v("主机系统服务 (iptables, socat, etc)")])])])]),s._v(" "),n("h2",{attrs:{id:"离线安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#离线安装"}},[s._v("#")]),s._v(" 离线安装")]),s._v(" "),n("h3",{attrs:{id:"_1、准备镜像目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、准备镜像目录"}},[s._v("#")]),s._v(" 1、准备镜像目录")]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("在能够连接外网的机器中，获取k3s 的git下获取离线安装镜像包")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取k3s离线镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/rancher/k3s/releases/download/v1.18.2%2Bk3s1/k3s-airgap-images-amd64.tar\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建镜像目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /var/lib/rancher/k3s/agent/images/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝下载好的镜像到创建好的镜像目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" k3s-airgap-images-amd64.tar /var/lib/rancher/k3s/agent/images/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("blockquote",[n("p",[n("strong",[s._v("注意：")]),s._v(" 这里我在完全离线的环境下安装环境下，还是会出下载外网的镜像，所以我提前将离线镜像导入到docker中")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 手动导入k3s镜像")]),s._v("\ndocker load "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" k3s-airgap-images-amd64.tar\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"_2、创建镜像仓库yaml文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、创建镜像仓库yaml文件"}},[s._v("#")]),s._v(" 2、创建镜像仓库YAML文件")]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("在"),n("code",[s._v("/etc/rancher/k3s/registries.yaml")]),s._v("创建registries.yaml文件，registries.yaml文件应如下所示：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mirrors")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"microid.docker.com:5000"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("endpoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://microid.docker.com:5000"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 我这里的docker私有仓库没有配置tls认证，所以不需要配置证书")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_3、安装k3s"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、安装k3s"}},[s._v("#")]),s._v(" 3、安装k3s")]),s._v(" "),n("p",[s._v("通过"),n("a",{attrs:{href:"https://github.com/rancher/k3s/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("发行页面"),n("OutboundLink")],1),s._v("下载K3s二进制文件和离线镜像包。还可以在"),n("code",[s._v("https://get.k3s.io")]),s._v("上获取K3s安装脚本。")]),s._v(" "),n("p",[s._v("将二进制文件放在每个节点的"),n("code",[s._v("/usr/local/bin")]),s._v("，将安装脚本放置在每个节点上的任意位置，并将其命名为"),n("code",[s._v("install.sh")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载k3s二进制文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/rancher/k3s/releases/download/v1.18.2%2Bk3s1/k3s\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取安装脚本，由于网络原因安装脚本可能下载会失败，这里将下载好的脚本内容粘贴在该处")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -e\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Usage:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   curl ... | ENV_VAR=... sh -")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       or")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   ENV_VAR=... ./install.sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Example:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   Installing a server without traefik:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     curl ... | INSTALL_K3S_EXEC="--no-deploy=traefik" sh -')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   Installing an agent to point at a server:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     curl ... | K3S_TOKEN=xxx K3S_URL=https://server-url:6443 sh -")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Environment variables:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - K3S_*")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Environment variables which begin with K3S_ will be preserved for the")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     systemd service to use. Setting K3S_URL without explicitly setting")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     a systemd exec command will default the command to "agent", and we')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     enforce that K3S_TOKEN or K3S_CLUSTER_SECRET is also set.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_SKIP_DOWNLOAD")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     If set to true will not download k3s hash or binary.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_SYMLINK")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     If set to 'skip' will not create symlinks, 'force' will overwrite,")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     default will symlink if command does not exist in path.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_SKIP_ENABLE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     If set to true will not enable or start k3s service.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_SKIP_START")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     If set to true will not start k3s service.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_VERSION")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Version of k3s to download from github. Will attempt to download from the")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     stable channel if not specified.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_COMMIT")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Commit of k3s to download from temporary cloud storage.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     * (for developer & QA use)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_BIN_DIR")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Directory to install k3s binary, links, and uninstall script to, or use")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     /usr/local/bin as the default")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_BIN_DIR_READ_ONLY")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     If set to true will not write files to INSTALL_K3S_BIN_DIR, forces")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     setting INSTALL_K3S_SKIP_DOWNLOAD=true")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_SYSTEMD_DIR")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Directory to install systemd service and environment files to, or use")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     /etc/systemd/system as the default")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_EXEC or script arguments")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Command with flags to use for launching k3s in the systemd service, if")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     the command is not specified will default to "agent" if K3S_URL is set')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     or "server" if not. The final systemd command resolves to a combination')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     of EXEC and script args ($@).")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     The following commands result in the same behavior:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#       curl ... | INSTALL_K3S_EXEC="--no-deploy=traefik" sh -s -')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#       curl ... | INSTALL_K3S_EXEC="server --no-deploy=traefik" sh -s -')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#       curl ... | INSTALL_K3S_EXEC="server" sh -s - --no-deploy=traefik')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       curl ... | sh -s - server --no-deploy=traefik")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       curl ... | sh -s - --no-deploy=traefik")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_NAME")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Name of systemd service to create, will default from the k3s exec command")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     if not specified. If specified the name will be prefixed with 'k3s-'.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_TYPE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Type of systemd service to create, will default from the k3s exec command")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     if not specified.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_SELINUX_WARN")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     If set to true will continue if k3s-selinux policy is not found.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_CHANNEL_URL")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Channel URL for fetching k3s download URL.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Defaults to 'https://update.k3s.io/v1-release/channels'.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - INSTALL_K3S_CHANNEL")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Channel to use for fetching k3s download URL.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     Defaults to 'stable'.")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GITHUB_URL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://github.com/rancher/k3s/releases\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("STORAGE_URL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://storage.googleapis.com/k3s-ci-builds\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOWNLOADER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- helper functions for logs ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[INFO] '")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("warn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[WARN] '")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("fatal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[ERROR] '")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&2")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- fatal if no systemd or openrc ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("verify_system")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -x /sbin/openrc-run "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HAS_OPENRC")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -d /run/systemd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HAS_SYSTEMD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    fatal "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Can not find systemd or openrc to use as a process supervisor for k3s'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- add quotes to command arguments ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("quote")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("arg")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%s"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"s/'/'"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),n("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("''/g;1s/^/'/;\\"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$s")]),s._v("/\\$/'/\"")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- add indentation and trailing slash to quoted args ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("quote_indent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' "),n("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("arg")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[s._v("\\t")]),s._v("%s "),n("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("quote "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$arg")]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- escape most punctuation characters, except quotes, forward slash, and space ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("escape")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%s'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/\\([][!#$%&()*;<=>?\\_"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/g"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\n}\n\n# --- escape double quotes ---\nescape_dq() {\n    printf '")]),s._v("%s"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' \""),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v("\" | sed -e '")]),s._v("s/"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/'),n("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v('"')]),s._v("/g"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\n}\n\n# --- define needed environment variables ---\nsetup_env() {\n    # --- use command args if passed or create default ---\n    case \""),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('" in\n        # --- if we only have flags discover if command should be server or agent ---\n        (-*|"")\n            if [ -z "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${K3S_URL}")]),s._v('" ]; then\n                CMD_K3S=server\n            else\n                if [ -z "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${K3S_TOKEN}")]),s._v('" ] && [ -z "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${K3S_CLUSTER_SECRET}")]),s._v('" ]; then\n                    fatal "Defaulted k3s exec command to \'')]),s._v("agent"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' because K3S_URL is defined, but K3S_TOKEN or K3S_CLUSTER_SECRET is not defined.\"\n                fi\n                CMD_K3S=agent\n            fi\n        ;;\n        # --- command is provided ---\n        (*)\n            CMD_K3S="),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('\n            shift\n        ;;\n    esac\n    CMD_K3S_EXEC="'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMD_K3S}")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("quote_indent "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"\n\n    # --- use systemd name if defined or create default ---\n    if [ -n "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_NAME}")]),s._v('" ]; then\n        SYSTEM_NAME=k3s-'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_NAME}")]),s._v('\n    else\n        if [ "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMD_K3S}")]),s._v('" = server ]; then\n            SYSTEM_NAME=k3s\n        else\n            SYSTEM_NAME=k3s-'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMD_K3S}")]),s._v("\n        fi\n    fi\n\n    # --- check for invalid characters in system name ---\n    valid_chars=$(printf '")]),s._v("%s"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' \""),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v("\" | sed -e '")]),s._v("s/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$%&()*;<=>?\\_")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("{|}/[:space:]]/^/g;'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${valid_chars}")]),s._v('"')]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("invalid_chars")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%s'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${valid_chars}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/[^^]/ /g'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n        fatal "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Invalid characters for system name:\n            '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${invalid_chars}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- use sudo if we are not already root ---")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SUDO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sudo\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SUDO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- use systemd type if defined or create default ---")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_TYPE}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYSTEMD_TYPE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_TYPE}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMD_K3S}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYSTEMD_TYPE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("notify\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYSTEMD_TYPE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exec\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- use binary install directory if defined or create default ---")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_BIN_DIR}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BIN_DIR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_BIN_DIR}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BIN_DIR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/bin\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- use systemd directory if defined or create default ---")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_SYSTEMD_DIR}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYSTEMD_DIR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_SYSTEMD_DIR}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYSTEMD_DIR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/systemd/system\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- set related files from system name ---")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVICE_K3S")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v(".service\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UNINSTALL_K3S_SH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${UNINSTALL_K3S_SH"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v("${BIN_DIR}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v("-uninstall.sh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KILLALL_K3S_SH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KILLALL_K3S_SH"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v("${BIN_DIR}")]),s._v("/k3s-killall.sh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- use service or environment location depending on systemd/openrc ---")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HAS_SYSTEMD}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FILE_K3S_SERVICE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEMD_DIR}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVICE_K3S}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FILE_K3S_ENV")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEMD_DIR}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVICE_K3S}")]),s._v(".env\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HAS_OPENRC}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/rancher/k3s\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FILE_K3S_SERVICE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/init.d/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FILE_K3S_ENV")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/rancher/k3s/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v(".env\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- get hash of config & exec for currently installed k3s ---")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRE_INSTALL_HASHES")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("get_installed_hashes"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- if bin directory is read only skip download ---")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_BIN_DIR_READ_ONLY}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INSTALL_K3S_SKIP_DOWNLOAD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- setup channel values")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INSTALL_K3S_CHANNEL_URL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_CHANNEL_URL"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v("'https"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("update.k3s.io"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1-release"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("channels'}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INSTALL_K3S_CHANNEL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_CHANNEL"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v("'stable'}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- check if skip download environment variable set ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("can_skip_download")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_SKIP_DOWNLOAD}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- verify an executabe k3s binary is installed ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("verify_k3s_is_executable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -x "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/k3s "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        fatal "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Executable k3s binary not found at '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v('/k3s"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- set arch and suffix, fatal if architecture not supported ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("setup_verify_arch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ARCH")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ARCH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -m"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ARCH")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n        amd64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ARCH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("amd64\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SUFFIX")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        x86_64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ARCH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("amd64\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SUFFIX")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        arm64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ARCH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("arm64\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SUFFIX")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ARCH}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        aarch64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ARCH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("arm64\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SUFFIX")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ARCH}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        arm*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ARCH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("arm\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SUFFIX")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ARCH}")]),s._v("hf\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            fatal "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Unsupported architecture '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ARCH")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- verify existence of network downloader executable ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("verify_downloader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Return failure if it doesn't exist or is no executable")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -x "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" $1"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set verified executable as our downloader program and return success")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOWNLOADER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- create tempory directory and cleanup when done ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("setup_tmp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TMP_DIR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("mktemp -d -t k3s-install.XXXXXXXXXX"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TMP_HASH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TMP_DIR}")]),s._v("/k3s.hash\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TMP_BIN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TMP_DIR}")]),s._v("/k3s.bin\n    "),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("cleanup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("code")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" +e\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("trap")]),s._v(" - EXIT\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TMP_DIR}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$code")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("trap")]),s._v(" cleanup INT EXIT\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- use desired k3s version if defined or find version from channel ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("get_release_version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_COMMIT}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION_K3S")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"commit '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_COMMIT}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_VERSION}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION_K3S")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_VERSION}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Finding release for channel '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_CHANNEL}")]),s._v('"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version_url")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_CHANNEL_URL}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_CHANNEL}")]),s._v('"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOWNLOADER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION_K3S")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -w "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%{url_effective}'")]),s._v(" -L -s -S $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("version_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -o /dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s|.*/||'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION_K3S")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -SqO /dev/null $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("version_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -i Location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s|.*/||'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                fatal "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Incorrect downloader executable '"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOWNLOADER")]),s._v("'\"")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Using '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION_K3S}")]),s._v(' as release"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- download from github url ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("download")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$#")]),s._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" fatal "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'download needs exactly 2 arguments'")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOWNLOADER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -o "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" -sfL "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -qO "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            fatal "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Incorrect executable '"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOWNLOADER")]),s._v("'\"")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Abort if download command failed")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" fatal "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Download failed'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- download hash from github url ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("download_hash")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_COMMIT}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HASH_URL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${STORAGE_URL}")]),s._v("/k3s"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SUFFIX}")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_COMMIT}")]),s._v(".sha256sum\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HASH_URL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${GITHUB_URL}")]),s._v("/download/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION_K3S}")]),s._v("/sha256sum-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ARCH}")]),s._v(".txt\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Downloading hash '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_URL}")]),s._v('"')]),s._v("\n    download "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TMP_HASH}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_URL}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HASH_EXPECTED")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('" k3s'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SUFFIX}")]),s._v('$"')]),s._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("TMP_HASH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HASH_EXPECTED")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_EXPECTED"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%%")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("blank"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- check hash against installed version ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("installed_hash_matches")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -x "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/k3s "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HASH_INSTALLED")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("sha256sum $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BIN_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/k3s"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HASH_INSTALLED")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_INSTALLED"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%%")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("blank"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_EXPECTED}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_INSTALLED}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- download binary from github url ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("download_binary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_COMMIT}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BIN_URL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${STORAGE_URL}")]),s._v("/k3s"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SUFFIX}")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_COMMIT}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BIN_URL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${GITHUB_URL}")]),s._v("/download/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION_K3S}")]),s._v("/k3s"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SUFFIX}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Downloading binary '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_URL}")]),s._v('"')]),s._v("\n    download "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TMP_BIN}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_URL}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- verify downloaded binary hash ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("verify_binary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Verifying binary download"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HASH_BIN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("sha256sum $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("TMP_BIN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HASH_BIN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_BIN"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%%")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("blank"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_EXPECTED}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_BIN}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        fatal "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Download sha256 does not match '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_EXPECTED}")]),s._v(", got "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HASH_BIN}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- setup permissions and move binary to system directory ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("setup_binary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TMP_BIN}")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Installing k3s to '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v('/k3s"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" root:root "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TMP_BIN}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TMP_BIN}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/k3s\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- setup selinux policy ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("setup_selinux")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("policy_hint")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"please install:\n    yum install -y container-selinux selinux-policy-base\n    rpm -i https://rpm.rancher.io/k3s-selinux-0.1.1-rc1.el7.noarch.rpm\n"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("policy_error")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fatal\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$INSTALL_K3S_SELINUX_WARN")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("policy_error")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("warn\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" chcon -u system_u -r object_r -t container_runtime_exec_t "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/k3s "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^\\s*SELINUX=enforcing'")]),s._v(" /etc/selinux/config "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$policy_error")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to apply container_runtime_exec_t to '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/k3s, "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${policy_hint}")]),s._v('"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -f /usr/share/selinux/packages/k3s.pp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$policy_error")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to find the k3s-selinux policy, '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${policy_hint}")]),s._v('"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- download and verify k3s ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("download_and_verify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" can_skip_download"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n       info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Skipping k3s download and verify'")]),s._v("\n       verify_k3s_is_executable\n       "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    setup_verify_arch\n    verify_downloader "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" verify_downloader "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" fatal "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Can not find curl or wget for downloading files'")]),s._v("\n    setup_tmp\n    get_release_version\n    download_hash\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" installed_hash_matches"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Skipping binary downloaded, installed k3s matches hash'")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    download_binary\n    verify_binary\n    setup_binary\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- add additional utility links ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("create_symlinks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_BIN_DIR_READ_ONLY}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_SYMLINK}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" skip "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("cmd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" kubectl crictl ctr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${cmd}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_SYMLINK}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" force "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("which_cmd")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${which_cmd}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_SYMLINK}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" force "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n                info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Creating '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${cmd}")]),s._v(' symlink to k3s"')]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -sf k3s "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${cmd}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n                info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Skipping '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${cmd}")]),s._v(" symlink to k3s, command exists in PATH at "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${which_cmd}")]),s._v('"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n            info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Skipping '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${cmd}")]),s._v(' symlink to k3s, already exists"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- create killall script ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("create_killall")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_BIN_DIR_READ_ONLY}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Creating killall script '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KILLALL_K3S_SH}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KILLALL_K3S_SH}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("EOF\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("bin")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /var/lib/rancher/k3s/data/**/bin/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$bin")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$bin")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$bin")]),s._v("/aux\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -x\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("service")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /etc/systemd/system/k3s*.service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -s "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$service")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl stop "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("basename")]),s._v(" $service"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("service")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /etc/init.d/k3s*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -x "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$service")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$service")]),s._v(" stop\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("pschildren")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -e -o "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ppid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" -o "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^\\s*//g; s/\\s\\s*/"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[s._v("\\t")]),s._v("/g;'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -w "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" -f2\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("pstree")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("pid")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$pid")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("child")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("pschildren $pid"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n            pstree "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$child")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("killtree")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" +x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        pstree $@"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("getshims")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -e -o "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" -o "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("args")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^ *//; s/\\s\\s*/"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[s._v("\\t")]),s._v("/;'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -w "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'k3s/data/[^/]*/bin/containerd-shim'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" -f1\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nkilltree "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" +x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" getshims"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -x"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("do_unmount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" +x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MOUNTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" ignore "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" ignore"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MOUNTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mount")]),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MOUNTS")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/proc/self/mounts\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MOUNTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" $MOUNTS "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -r"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MOUNTS}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -x\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("umount")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MOUNTS}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -x\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\ndo_unmount "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/run/k3s'")]),s._v("\ndo_unmount "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/var/lib/rancher/k3s'")]),s._v("\ndo_unmount "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/var/lib/kubelet/pods'")]),s._v("\ndo_unmount "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/run/netns/cni-'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Delete network interface(s) that match 'master cni0'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" show "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'master cni0'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" ignore iface ignore"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("iface")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${iface"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%%")]),s._v("@*}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$iface")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" delete "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$iface")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" delete cni0\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" delete flannel.1\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /var/lib/cni/\niptables-save "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v KUBE- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v CNI- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" iptables-restore\nEOF\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KILLALL_K3S_SH}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" root:root "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KILLALL_K3S_SH}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- create uninstall script ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("create_uninstall")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_BIN_DIR_READ_ONLY}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Creating uninstall script '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${UNINSTALL_K3S_SH}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${UNINSTALL_K3S_SH}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n#!/bin/sh\nset -x\n[ \\"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" -eq 0 ] || exec sudo \\"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(" \\"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KILLALL_K3S_SH}")]),s._v("\n\nif which systemctl; then\n    systemctl disable "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v("\n    systemctl reset-failed "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v("\n    systemctl daemon-reload\nfi\nif which rc-update; then\n    rc-update delete "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v(" default\nfi\n\nrm -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_SERVICE}")]),s._v("\nrm -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_ENV}")]),s._v("\n\nremove_uninstall() {\n    rm -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${UNINSTALL_K3S_SH}")]),s._v("\n}\ntrap remove_uninstall EXIT\n\nif (ls "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEMD_DIR}")]),s._v("/k3s*.service || ls /etc/init.d/k3s*) >/dev/null 2>&1; then\n    set +x; echo 'Additional k3s services installed, skipping uninstall of k3s'; set -x\n    exit\nfi\n\nfor cmd in kubectl crictl ctr; do\n    if [ -L "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/\\"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cmd")]),s._v(" ]; then\n        rm -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/\\"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cmd")]),s._v("\n    fi\ndone\n\nrm -rf /etc/rancher/k3s\nrm -rf /var/lib/rancher/k3s\nrm -rf /var/lib/kubelet\nrm -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/k3s\nrm -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KILLALL_K3S_SH}")]),s._v("\nEOF")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${UNINSTALL_K3S_SH}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" root:root "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${UNINSTALL_K3S_SH}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- disable current service if loaded --")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("systemd_disable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f /etc/systemd/system/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVICE_K3S}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f /etc/systemd/system/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVICE_K3S}")]),s._v(".env "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" systemctl disable "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- capture current env and create file containing k3s_ variables ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("create_env_file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"env: Creating environment file '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_ENV}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UMASK")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("umask")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("umask")]),s._v(" 0377\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^K3S_'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_ENV}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" -i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^(NO|HTTP|HTTPS)_PROXY'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_ENV}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("umask")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UMASK")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- write systemd service file ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("create_systemd_service_file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemd: Creating service file '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_SERVICE}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_SERVICE}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[Unit]\nDescription=Lightweight Kubernetes\nDocumentation=https://k3s.io\nWants=network-online.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nType="),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEMD_TYPE}")]),s._v("\nEnvironmentFile="),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_ENV}")]),s._v("\nKillMode=process\nDelegate=yes\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nTimeoutStartSec=0\nRestart=always\nRestartSec=5s\nExecStartPre=-/sbin/modprobe br_netfilter\nExecStartPre=-/sbin/modprobe overlay\nExecStart="),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/k3s "),n("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMD_K3S_EXEC}")]),s._v("\n\nEOF")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- write openrc service file ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("create_openrc_service_file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOG_FILE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v(".log\n\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openrc: Creating service file '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_SERVICE}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_SERVICE}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n#!/sbin/openrc-run\n\ndepend() {\n    after network-online\n    want cgroups\n}\n\nstart_pre() {\n    rm -f /tmp/k3s.*\n}\n\nsupervisor=supervise-daemon\nname="),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v('\ncommand="'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v('/k3s"\ncommand_args="'),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("escape_dq "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMD_K3S_EXEC}")]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    >>"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_FILE}")]),s._v(' 2>&1"\n\noutput_log='),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_FILE}")]),s._v("\nerror_log="),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_FILE}")]),s._v('\n\npidfile="/var/run/'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v('.pid"\nrespawn_delay=5\n\nset -o allexport\nif [ -f /etc/environment ]; then source /etc/environment; fi\nif [ -f '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_ENV}")]),s._v(" ]; then source "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_ENV}")]),s._v("; fi\nset +o allexport\nEOF")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" 0755 "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_SERVICE}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/logrotate.d/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_FILE}")]),s._v(" {\n\tmissingok\n\tnotifempty\n\tcopytruncate\n}\nEOF")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- write systemd or openrc service file ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("create_service_file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HAS_SYSTEMD}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" create_systemd_service_file\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HAS_OPENRC}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" create_openrc_service_file\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- get hashes of the current k3s bin and service files")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("get_installed_hashes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" sha256sum "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BIN_DIR}")]),s._v("/k3s "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_SERVICE}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_ENV}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- enable and start systemd service ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("systemd_enable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemd: Enabling '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v(' unit"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_SERVICE}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" systemctl daemon-reload "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("systemd_start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemd: Starting '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" systemctl restart "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- enable and start openrc service ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("openrc_enable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openrc: Enabling '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v(' service for default runlevel"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" rc-update "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v(" default "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("openrc_start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openrc: Starting '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SYSTEM_NAME}")]),s._v('"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SUDO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE_K3S_SERVICE}")]),s._v(" restart\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- startup systemd or openrc service ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("service_enable_and_start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_SKIP_ENABLE}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HAS_SYSTEMD}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemd_enable\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HAS_OPENRC}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" openrc_enable\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_SKIP_START}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("POST_INSTALL_HASHES")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("get_installed_hashes"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PRE_INSTALL_HASHES}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${POST_INSTALL_HASHES}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        info "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'No change detected so skipping service start'")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HAS_SYSTEMD}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemd_start\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HAS_OPENRC}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" openrc_start\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- re-evaluate args to include env command ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("eval")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -- "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("escape "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTALL_K3S_EXEC}")]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("quote "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --- run the install process --")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    verify_system\n    setup_env "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v("\n    download_and_verify\n    setup_selinux\n    create_symlinks\n    create_killall\n    create_uninstall\n    systemd_disable\n    create_env_file\n    create_service_file\n    service_enable_and_start\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#----脚本内容结束")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br"),n("span",{staticClass:"line-number"},[s._v("180")]),n("br"),n("span",{staticClass:"line-number"},[s._v("181")]),n("br"),n("span",{staticClass:"line-number"},[s._v("182")]),n("br"),n("span",{staticClass:"line-number"},[s._v("183")]),n("br"),n("span",{staticClass:"line-number"},[s._v("184")]),n("br"),n("span",{staticClass:"line-number"},[s._v("185")]),n("br"),n("span",{staticClass:"line-number"},[s._v("186")]),n("br"),n("span",{staticClass:"line-number"},[s._v("187")]),n("br"),n("span",{staticClass:"line-number"},[s._v("188")]),n("br"),n("span",{staticClass:"line-number"},[s._v("189")]),n("br"),n("span",{staticClass:"line-number"},[s._v("190")]),n("br"),n("span",{staticClass:"line-number"},[s._v("191")]),n("br"),n("span",{staticClass:"line-number"},[s._v("192")]),n("br"),n("span",{staticClass:"line-number"},[s._v("193")]),n("br"),n("span",{staticClass:"line-number"},[s._v("194")]),n("br"),n("span",{staticClass:"line-number"},[s._v("195")]),n("br"),n("span",{staticClass:"line-number"},[s._v("196")]),n("br"),n("span",{staticClass:"line-number"},[s._v("197")]),n("br"),n("span",{staticClass:"line-number"},[s._v("198")]),n("br"),n("span",{staticClass:"line-number"},[s._v("199")]),n("br"),n("span",{staticClass:"line-number"},[s._v("200")]),n("br"),n("span",{staticClass:"line-number"},[s._v("201")]),n("br"),n("span",{staticClass:"line-number"},[s._v("202")]),n("br"),n("span",{staticClass:"line-number"},[s._v("203")]),n("br"),n("span",{staticClass:"line-number"},[s._v("204")]),n("br"),n("span",{staticClass:"line-number"},[s._v("205")]),n("br"),n("span",{staticClass:"line-number"},[s._v("206")]),n("br"),n("span",{staticClass:"line-number"},[s._v("207")]),n("br"),n("span",{staticClass:"line-number"},[s._v("208")]),n("br"),n("span",{staticClass:"line-number"},[s._v("209")]),n("br"),n("span",{staticClass:"line-number"},[s._v("210")]),n("br"),n("span",{staticClass:"line-number"},[s._v("211")]),n("br"),n("span",{staticClass:"line-number"},[s._v("212")]),n("br"),n("span",{staticClass:"line-number"},[s._v("213")]),n("br"),n("span",{staticClass:"line-number"},[s._v("214")]),n("br"),n("span",{staticClass:"line-number"},[s._v("215")]),n("br"),n("span",{staticClass:"line-number"},[s._v("216")]),n("br"),n("span",{staticClass:"line-number"},[s._v("217")]),n("br"),n("span",{staticClass:"line-number"},[s._v("218")]),n("br"),n("span",{staticClass:"line-number"},[s._v("219")]),n("br"),n("span",{staticClass:"line-number"},[s._v("220")]),n("br"),n("span",{staticClass:"line-number"},[s._v("221")]),n("br"),n("span",{staticClass:"line-number"},[s._v("222")]),n("br"),n("span",{staticClass:"line-number"},[s._v("223")]),n("br"),n("span",{staticClass:"line-number"},[s._v("224")]),n("br"),n("span",{staticClass:"line-number"},[s._v("225")]),n("br"),n("span",{staticClass:"line-number"},[s._v("226")]),n("br"),n("span",{staticClass:"line-number"},[s._v("227")]),n("br"),n("span",{staticClass:"line-number"},[s._v("228")]),n("br"),n("span",{staticClass:"line-number"},[s._v("229")]),n("br"),n("span",{staticClass:"line-number"},[s._v("230")]),n("br"),n("span",{staticClass:"line-number"},[s._v("231")]),n("br"),n("span",{staticClass:"line-number"},[s._v("232")]),n("br"),n("span",{staticClass:"line-number"},[s._v("233")]),n("br"),n("span",{staticClass:"line-number"},[s._v("234")]),n("br"),n("span",{staticClass:"line-number"},[s._v("235")]),n("br"),n("span",{staticClass:"line-number"},[s._v("236")]),n("br"),n("span",{staticClass:"line-number"},[s._v("237")]),n("br"),n("span",{staticClass:"line-number"},[s._v("238")]),n("br"),n("span",{staticClass:"line-number"},[s._v("239")]),n("br"),n("span",{staticClass:"line-number"},[s._v("240")]),n("br"),n("span",{staticClass:"line-number"},[s._v("241")]),n("br"),n("span",{staticClass:"line-number"},[s._v("242")]),n("br"),n("span",{staticClass:"line-number"},[s._v("243")]),n("br"),n("span",{staticClass:"line-number"},[s._v("244")]),n("br"),n("span",{staticClass:"line-number"},[s._v("245")]),n("br"),n("span",{staticClass:"line-number"},[s._v("246")]),n("br"),n("span",{staticClass:"line-number"},[s._v("247")]),n("br"),n("span",{staticClass:"line-number"},[s._v("248")]),n("br"),n("span",{staticClass:"line-number"},[s._v("249")]),n("br"),n("span",{staticClass:"line-number"},[s._v("250")]),n("br"),n("span",{staticClass:"line-number"},[s._v("251")]),n("br"),n("span",{staticClass:"line-number"},[s._v("252")]),n("br"),n("span",{staticClass:"line-number"},[s._v("253")]),n("br"),n("span",{staticClass:"line-number"},[s._v("254")]),n("br"),n("span",{staticClass:"line-number"},[s._v("255")]),n("br"),n("span",{staticClass:"line-number"},[s._v("256")]),n("br"),n("span",{staticClass:"line-number"},[s._v("257")]),n("br"),n("span",{staticClass:"line-number"},[s._v("258")]),n("br"),n("span",{staticClass:"line-number"},[s._v("259")]),n("br"),n("span",{staticClass:"line-number"},[s._v("260")]),n("br"),n("span",{staticClass:"line-number"},[s._v("261")]),n("br"),n("span",{staticClass:"line-number"},[s._v("262")]),n("br"),n("span",{staticClass:"line-number"},[s._v("263")]),n("br"),n("span",{staticClass:"line-number"},[s._v("264")]),n("br"),n("span",{staticClass:"line-number"},[s._v("265")]),n("br"),n("span",{staticClass:"line-number"},[s._v("266")]),n("br"),n("span",{staticClass:"line-number"},[s._v("267")]),n("br"),n("span",{staticClass:"line-number"},[s._v("268")]),n("br"),n("span",{staticClass:"line-number"},[s._v("269")]),n("br"),n("span",{staticClass:"line-number"},[s._v("270")]),n("br"),n("span",{staticClass:"line-number"},[s._v("271")]),n("br"),n("span",{staticClass:"line-number"},[s._v("272")]),n("br"),n("span",{staticClass:"line-number"},[s._v("273")]),n("br"),n("span",{staticClass:"line-number"},[s._v("274")]),n("br"),n("span",{staticClass:"line-number"},[s._v("275")]),n("br"),n("span",{staticClass:"line-number"},[s._v("276")]),n("br"),n("span",{staticClass:"line-number"},[s._v("277")]),n("br"),n("span",{staticClass:"line-number"},[s._v("278")]),n("br"),n("span",{staticClass:"line-number"},[s._v("279")]),n("br"),n("span",{staticClass:"line-number"},[s._v("280")]),n("br"),n("span",{staticClass:"line-number"},[s._v("281")]),n("br"),n("span",{staticClass:"line-number"},[s._v("282")]),n("br"),n("span",{staticClass:"line-number"},[s._v("283")]),n("br"),n("span",{staticClass:"line-number"},[s._v("284")]),n("br"),n("span",{staticClass:"line-number"},[s._v("285")]),n("br"),n("span",{staticClass:"line-number"},[s._v("286")]),n("br"),n("span",{staticClass:"line-number"},[s._v("287")]),n("br"),n("span",{staticClass:"line-number"},[s._v("288")]),n("br"),n("span",{staticClass:"line-number"},[s._v("289")]),n("br"),n("span",{staticClass:"line-number"},[s._v("290")]),n("br"),n("span",{staticClass:"line-number"},[s._v("291")]),n("br"),n("span",{staticClass:"line-number"},[s._v("292")]),n("br"),n("span",{staticClass:"line-number"},[s._v("293")]),n("br"),n("span",{staticClass:"line-number"},[s._v("294")]),n("br"),n("span",{staticClass:"line-number"},[s._v("295")]),n("br"),n("span",{staticClass:"line-number"},[s._v("296")]),n("br"),n("span",{staticClass:"line-number"},[s._v("297")]),n("br"),n("span",{staticClass:"line-number"},[s._v("298")]),n("br"),n("span",{staticClass:"line-number"},[s._v("299")]),n("br"),n("span",{staticClass:"line-number"},[s._v("300")]),n("br"),n("span",{staticClass:"line-number"},[s._v("301")]),n("br"),n("span",{staticClass:"line-number"},[s._v("302")]),n("br"),n("span",{staticClass:"line-number"},[s._v("303")]),n("br"),n("span",{staticClass:"line-number"},[s._v("304")]),n("br"),n("span",{staticClass:"line-number"},[s._v("305")]),n("br"),n("span",{staticClass:"line-number"},[s._v("306")]),n("br"),n("span",{staticClass:"line-number"},[s._v("307")]),n("br"),n("span",{staticClass:"line-number"},[s._v("308")]),n("br"),n("span",{staticClass:"line-number"},[s._v("309")]),n("br"),n("span",{staticClass:"line-number"},[s._v("310")]),n("br"),n("span",{staticClass:"line-number"},[s._v("311")]),n("br"),n("span",{staticClass:"line-number"},[s._v("312")]),n("br"),n("span",{staticClass:"line-number"},[s._v("313")]),n("br"),n("span",{staticClass:"line-number"},[s._v("314")]),n("br"),n("span",{staticClass:"line-number"},[s._v("315")]),n("br"),n("span",{staticClass:"line-number"},[s._v("316")]),n("br"),n("span",{staticClass:"line-number"},[s._v("317")]),n("br"),n("span",{staticClass:"line-number"},[s._v("318")]),n("br"),n("span",{staticClass:"line-number"},[s._v("319")]),n("br"),n("span",{staticClass:"line-number"},[s._v("320")]),n("br"),n("span",{staticClass:"line-number"},[s._v("321")]),n("br"),n("span",{staticClass:"line-number"},[s._v("322")]),n("br"),n("span",{staticClass:"line-number"},[s._v("323")]),n("br"),n("span",{staticClass:"line-number"},[s._v("324")]),n("br"),n("span",{staticClass:"line-number"},[s._v("325")]),n("br"),n("span",{staticClass:"line-number"},[s._v("326")]),n("br"),n("span",{staticClass:"line-number"},[s._v("327")]),n("br"),n("span",{staticClass:"line-number"},[s._v("328")]),n("br"),n("span",{staticClass:"line-number"},[s._v("329")]),n("br"),n("span",{staticClass:"line-number"},[s._v("330")]),n("br"),n("span",{staticClass:"line-number"},[s._v("331")]),n("br"),n("span",{staticClass:"line-number"},[s._v("332")]),n("br"),n("span",{staticClass:"line-number"},[s._v("333")]),n("br"),n("span",{staticClass:"line-number"},[s._v("334")]),n("br"),n("span",{staticClass:"line-number"},[s._v("335")]),n("br"),n("span",{staticClass:"line-number"},[s._v("336")]),n("br"),n("span",{staticClass:"line-number"},[s._v("337")]),n("br"),n("span",{staticClass:"line-number"},[s._v("338")]),n("br"),n("span",{staticClass:"line-number"},[s._v("339")]),n("br"),n("span",{staticClass:"line-number"},[s._v("340")]),n("br"),n("span",{staticClass:"line-number"},[s._v("341")]),n("br"),n("span",{staticClass:"line-number"},[s._v("342")]),n("br"),n("span",{staticClass:"line-number"},[s._v("343")]),n("br"),n("span",{staticClass:"line-number"},[s._v("344")]),n("br"),n("span",{staticClass:"line-number"},[s._v("345")]),n("br"),n("span",{staticClass:"line-number"},[s._v("346")]),n("br"),n("span",{staticClass:"line-number"},[s._v("347")]),n("br"),n("span",{staticClass:"line-number"},[s._v("348")]),n("br"),n("span",{staticClass:"line-number"},[s._v("349")]),n("br"),n("span",{staticClass:"line-number"},[s._v("350")]),n("br"),n("span",{staticClass:"line-number"},[s._v("351")]),n("br"),n("span",{staticClass:"line-number"},[s._v("352")]),n("br"),n("span",{staticClass:"line-number"},[s._v("353")]),n("br"),n("span",{staticClass:"line-number"},[s._v("354")]),n("br"),n("span",{staticClass:"line-number"},[s._v("355")]),n("br"),n("span",{staticClass:"line-number"},[s._v("356")]),n("br"),n("span",{staticClass:"line-number"},[s._v("357")]),n("br"),n("span",{staticClass:"line-number"},[s._v("358")]),n("br"),n("span",{staticClass:"line-number"},[s._v("359")]),n("br"),n("span",{staticClass:"line-number"},[s._v("360")]),n("br"),n("span",{staticClass:"line-number"},[s._v("361")]),n("br"),n("span",{staticClass:"line-number"},[s._v("362")]),n("br"),n("span",{staticClass:"line-number"},[s._v("363")]),n("br"),n("span",{staticClass:"line-number"},[s._v("364")]),n("br"),n("span",{staticClass:"line-number"},[s._v("365")]),n("br"),n("span",{staticClass:"line-number"},[s._v("366")]),n("br"),n("span",{staticClass:"line-number"},[s._v("367")]),n("br"),n("span",{staticClass:"line-number"},[s._v("368")]),n("br"),n("span",{staticClass:"line-number"},[s._v("369")]),n("br"),n("span",{staticClass:"line-number"},[s._v("370")]),n("br"),n("span",{staticClass:"line-number"},[s._v("371")]),n("br"),n("span",{staticClass:"line-number"},[s._v("372")]),n("br"),n("span",{staticClass:"line-number"},[s._v("373")]),n("br"),n("span",{staticClass:"line-number"},[s._v("374")]),n("br"),n("span",{staticClass:"line-number"},[s._v("375")]),n("br"),n("span",{staticClass:"line-number"},[s._v("376")]),n("br"),n("span",{staticClass:"line-number"},[s._v("377")]),n("br"),n("span",{staticClass:"line-number"},[s._v("378")]),n("br"),n("span",{staticClass:"line-number"},[s._v("379")]),n("br"),n("span",{staticClass:"line-number"},[s._v("380")]),n("br"),n("span",{staticClass:"line-number"},[s._v("381")]),n("br"),n("span",{staticClass:"line-number"},[s._v("382")]),n("br"),n("span",{staticClass:"line-number"},[s._v("383")]),n("br"),n("span",{staticClass:"line-number"},[s._v("384")]),n("br"),n("span",{staticClass:"line-number"},[s._v("385")]),n("br"),n("span",{staticClass:"line-number"},[s._v("386")]),n("br"),n("span",{staticClass:"line-number"},[s._v("387")]),n("br"),n("span",{staticClass:"line-number"},[s._v("388")]),n("br"),n("span",{staticClass:"line-number"},[s._v("389")]),n("br"),n("span",{staticClass:"line-number"},[s._v("390")]),n("br"),n("span",{staticClass:"line-number"},[s._v("391")]),n("br"),n("span",{staticClass:"line-number"},[s._v("392")]),n("br"),n("span",{staticClass:"line-number"},[s._v("393")]),n("br"),n("span",{staticClass:"line-number"},[s._v("394")]),n("br"),n("span",{staticClass:"line-number"},[s._v("395")]),n("br"),n("span",{staticClass:"line-number"},[s._v("396")]),n("br"),n("span",{staticClass:"line-number"},[s._v("397")]),n("br"),n("span",{staticClass:"line-number"},[s._v("398")]),n("br"),n("span",{staticClass:"line-number"},[s._v("399")]),n("br"),n("span",{staticClass:"line-number"},[s._v("400")]),n("br"),n("span",{staticClass:"line-number"},[s._v("401")]),n("br"),n("span",{staticClass:"line-number"},[s._v("402")]),n("br"),n("span",{staticClass:"line-number"},[s._v("403")]),n("br"),n("span",{staticClass:"line-number"},[s._v("404")]),n("br"),n("span",{staticClass:"line-number"},[s._v("405")]),n("br"),n("span",{staticClass:"line-number"},[s._v("406")]),n("br"),n("span",{staticClass:"line-number"},[s._v("407")]),n("br"),n("span",{staticClass:"line-number"},[s._v("408")]),n("br"),n("span",{staticClass:"line-number"},[s._v("409")]),n("br"),n("span",{staticClass:"line-number"},[s._v("410")]),n("br"),n("span",{staticClass:"line-number"},[s._v("411")]),n("br"),n("span",{staticClass:"line-number"},[s._v("412")]),n("br"),n("span",{staticClass:"line-number"},[s._v("413")]),n("br"),n("span",{staticClass:"line-number"},[s._v("414")]),n("br"),n("span",{staticClass:"line-number"},[s._v("415")]),n("br"),n("span",{staticClass:"line-number"},[s._v("416")]),n("br"),n("span",{staticClass:"line-number"},[s._v("417")]),n("br"),n("span",{staticClass:"line-number"},[s._v("418")]),n("br"),n("span",{staticClass:"line-number"},[s._v("419")]),n("br"),n("span",{staticClass:"line-number"},[s._v("420")]),n("br"),n("span",{staticClass:"line-number"},[s._v("421")]),n("br"),n("span",{staticClass:"line-number"},[s._v("422")]),n("br"),n("span",{staticClass:"line-number"},[s._v("423")]),n("br"),n("span",{staticClass:"line-number"},[s._v("424")]),n("br"),n("span",{staticClass:"line-number"},[s._v("425")]),n("br"),n("span",{staticClass:"line-number"},[s._v("426")]),n("br"),n("span",{staticClass:"line-number"},[s._v("427")]),n("br"),n("span",{staticClass:"line-number"},[s._v("428")]),n("br"),n("span",{staticClass:"line-number"},[s._v("429")]),n("br"),n("span",{staticClass:"line-number"},[s._v("430")]),n("br"),n("span",{staticClass:"line-number"},[s._v("431")]),n("br"),n("span",{staticClass:"line-number"},[s._v("432")]),n("br"),n("span",{staticClass:"line-number"},[s._v("433")]),n("br"),n("span",{staticClass:"line-number"},[s._v("434")]),n("br"),n("span",{staticClass:"line-number"},[s._v("435")]),n("br"),n("span",{staticClass:"line-number"},[s._v("436")]),n("br"),n("span",{staticClass:"line-number"},[s._v("437")]),n("br"),n("span",{staticClass:"line-number"},[s._v("438")]),n("br"),n("span",{staticClass:"line-number"},[s._v("439")]),n("br"),n("span",{staticClass:"line-number"},[s._v("440")]),n("br"),n("span",{staticClass:"line-number"},[s._v("441")]),n("br"),n("span",{staticClass:"line-number"},[s._v("442")]),n("br"),n("span",{staticClass:"line-number"},[s._v("443")]),n("br"),n("span",{staticClass:"line-number"},[s._v("444")]),n("br"),n("span",{staticClass:"line-number"},[s._v("445")]),n("br"),n("span",{staticClass:"line-number"},[s._v("446")]),n("br"),n("span",{staticClass:"line-number"},[s._v("447")]),n("br"),n("span",{staticClass:"line-number"},[s._v("448")]),n("br"),n("span",{staticClass:"line-number"},[s._v("449")]),n("br"),n("span",{staticClass:"line-number"},[s._v("450")]),n("br"),n("span",{staticClass:"line-number"},[s._v("451")]),n("br"),n("span",{staticClass:"line-number"},[s._v("452")]),n("br"),n("span",{staticClass:"line-number"},[s._v("453")]),n("br"),n("span",{staticClass:"line-number"},[s._v("454")]),n("br"),n("span",{staticClass:"line-number"},[s._v("455")]),n("br"),n("span",{staticClass:"line-number"},[s._v("456")]),n("br"),n("span",{staticClass:"line-number"},[s._v("457")]),n("br"),n("span",{staticClass:"line-number"},[s._v("458")]),n("br"),n("span",{staticClass:"line-number"},[s._v("459")]),n("br"),n("span",{staticClass:"line-number"},[s._v("460")]),n("br"),n("span",{staticClass:"line-number"},[s._v("461")]),n("br"),n("span",{staticClass:"line-number"},[s._v("462")]),n("br"),n("span",{staticClass:"line-number"},[s._v("463")]),n("br"),n("span",{staticClass:"line-number"},[s._v("464")]),n("br"),n("span",{staticClass:"line-number"},[s._v("465")]),n("br"),n("span",{staticClass:"line-number"},[s._v("466")]),n("br"),n("span",{staticClass:"line-number"},[s._v("467")]),n("br"),n("span",{staticClass:"line-number"},[s._v("468")]),n("br"),n("span",{staticClass:"line-number"},[s._v("469")]),n("br"),n("span",{staticClass:"line-number"},[s._v("470")]),n("br"),n("span",{staticClass:"line-number"},[s._v("471")]),n("br"),n("span",{staticClass:"line-number"},[s._v("472")]),n("br"),n("span",{staticClass:"line-number"},[s._v("473")]),n("br"),n("span",{staticClass:"line-number"},[s._v("474")]),n("br"),n("span",{staticClass:"line-number"},[s._v("475")]),n("br"),n("span",{staticClass:"line-number"},[s._v("476")]),n("br"),n("span",{staticClass:"line-number"},[s._v("477")]),n("br"),n("span",{staticClass:"line-number"},[s._v("478")]),n("br"),n("span",{staticClass:"line-number"},[s._v("479")]),n("br"),n("span",{staticClass:"line-number"},[s._v("480")]),n("br"),n("span",{staticClass:"line-number"},[s._v("481")]),n("br"),n("span",{staticClass:"line-number"},[s._v("482")]),n("br"),n("span",{staticClass:"line-number"},[s._v("483")]),n("br"),n("span",{staticClass:"line-number"},[s._v("484")]),n("br"),n("span",{staticClass:"line-number"},[s._v("485")]),n("br"),n("span",{staticClass:"line-number"},[s._v("486")]),n("br"),n("span",{staticClass:"line-number"},[s._v("487")]),n("br"),n("span",{staticClass:"line-number"},[s._v("488")]),n("br"),n("span",{staticClass:"line-number"},[s._v("489")]),n("br"),n("span",{staticClass:"line-number"},[s._v("490")]),n("br"),n("span",{staticClass:"line-number"},[s._v("491")]),n("br"),n("span",{staticClass:"line-number"},[s._v("492")]),n("br"),n("span",{staticClass:"line-number"},[s._v("493")]),n("br"),n("span",{staticClass:"line-number"},[s._v("494")]),n("br"),n("span",{staticClass:"line-number"},[s._v("495")]),n("br"),n("span",{staticClass:"line-number"},[s._v("496")]),n("br"),n("span",{staticClass:"line-number"},[s._v("497")]),n("br"),n("span",{staticClass:"line-number"},[s._v("498")]),n("br"),n("span",{staticClass:"line-number"},[s._v("499")]),n("br"),n("span",{staticClass:"line-number"},[s._v("500")]),n("br"),n("span",{staticClass:"line-number"},[s._v("501")]),n("br"),n("span",{staticClass:"line-number"},[s._v("502")]),n("br"),n("span",{staticClass:"line-number"},[s._v("503")]),n("br"),n("span",{staticClass:"line-number"},[s._v("504")]),n("br"),n("span",{staticClass:"line-number"},[s._v("505")]),n("br"),n("span",{staticClass:"line-number"},[s._v("506")]),n("br"),n("span",{staticClass:"line-number"},[s._v("507")]),n("br"),n("span",{staticClass:"line-number"},[s._v("508")]),n("br"),n("span",{staticClass:"line-number"},[s._v("509")]),n("br"),n("span",{staticClass:"line-number"},[s._v("510")]),n("br"),n("span",{staticClass:"line-number"},[s._v("511")]),n("br"),n("span",{staticClass:"line-number"},[s._v("512")]),n("br"),n("span",{staticClass:"line-number"},[s._v("513")]),n("br"),n("span",{staticClass:"line-number"},[s._v("514")]),n("br"),n("span",{staticClass:"line-number"},[s._v("515")]),n("br"),n("span",{staticClass:"line-number"},[s._v("516")]),n("br"),n("span",{staticClass:"line-number"},[s._v("517")]),n("br"),n("span",{staticClass:"line-number"},[s._v("518")]),n("br"),n("span",{staticClass:"line-number"},[s._v("519")]),n("br"),n("span",{staticClass:"line-number"},[s._v("520")]),n("br"),n("span",{staticClass:"line-number"},[s._v("521")]),n("br"),n("span",{staticClass:"line-number"},[s._v("522")]),n("br"),n("span",{staticClass:"line-number"},[s._v("523")]),n("br"),n("span",{staticClass:"line-number"},[s._v("524")]),n("br"),n("span",{staticClass:"line-number"},[s._v("525")]),n("br"),n("span",{staticClass:"line-number"},[s._v("526")]),n("br"),n("span",{staticClass:"line-number"},[s._v("527")]),n("br"),n("span",{staticClass:"line-number"},[s._v("528")]),n("br"),n("span",{staticClass:"line-number"},[s._v("529")]),n("br"),n("span",{staticClass:"line-number"},[s._v("530")]),n("br"),n("span",{staticClass:"line-number"},[s._v("531")]),n("br"),n("span",{staticClass:"line-number"},[s._v("532")]),n("br"),n("span",{staticClass:"line-number"},[s._v("533")]),n("br"),n("span",{staticClass:"line-number"},[s._v("534")]),n("br"),n("span",{staticClass:"line-number"},[s._v("535")]),n("br"),n("span",{staticClass:"line-number"},[s._v("536")]),n("br"),n("span",{staticClass:"line-number"},[s._v("537")]),n("br"),n("span",{staticClass:"line-number"},[s._v("538")]),n("br"),n("span",{staticClass:"line-number"},[s._v("539")]),n("br"),n("span",{staticClass:"line-number"},[s._v("540")]),n("br"),n("span",{staticClass:"line-number"},[s._v("541")]),n("br"),n("span",{staticClass:"line-number"},[s._v("542")]),n("br"),n("span",{staticClass:"line-number"},[s._v("543")]),n("br"),n("span",{staticClass:"line-number"},[s._v("544")]),n("br"),n("span",{staticClass:"line-number"},[s._v("545")]),n("br"),n("span",{staticClass:"line-number"},[s._v("546")]),n("br"),n("span",{staticClass:"line-number"},[s._v("547")]),n("br"),n("span",{staticClass:"line-number"},[s._v("548")]),n("br"),n("span",{staticClass:"line-number"},[s._v("549")]),n("br"),n("span",{staticClass:"line-number"},[s._v("550")]),n("br"),n("span",{staticClass:"line-number"},[s._v("551")]),n("br"),n("span",{staticClass:"line-number"},[s._v("552")]),n("br"),n("span",{staticClass:"line-number"},[s._v("553")]),n("br"),n("span",{staticClass:"line-number"},[s._v("554")]),n("br"),n("span",{staticClass:"line-number"},[s._v("555")]),n("br"),n("span",{staticClass:"line-number"},[s._v("556")]),n("br"),n("span",{staticClass:"line-number"},[s._v("557")]),n("br"),n("span",{staticClass:"line-number"},[s._v("558")]),n("br"),n("span",{staticClass:"line-number"},[s._v("559")]),n("br"),n("span",{staticClass:"line-number"},[s._v("560")]),n("br"),n("span",{staticClass:"line-number"},[s._v("561")]),n("br"),n("span",{staticClass:"line-number"},[s._v("562")]),n("br"),n("span",{staticClass:"line-number"},[s._v("563")]),n("br"),n("span",{staticClass:"line-number"},[s._v("564")]),n("br"),n("span",{staticClass:"line-number"},[s._v("565")]),n("br"),n("span",{staticClass:"line-number"},[s._v("566")]),n("br"),n("span",{staticClass:"line-number"},[s._v("567")]),n("br"),n("span",{staticClass:"line-number"},[s._v("568")]),n("br"),n("span",{staticClass:"line-number"},[s._v("569")]),n("br"),n("span",{staticClass:"line-number"},[s._v("570")]),n("br"),n("span",{staticClass:"line-number"},[s._v("571")]),n("br"),n("span",{staticClass:"line-number"},[s._v("572")]),n("br"),n("span",{staticClass:"line-number"},[s._v("573")]),n("br"),n("span",{staticClass:"line-number"},[s._v("574")]),n("br"),n("span",{staticClass:"line-number"},[s._v("575")]),n("br"),n("span",{staticClass:"line-number"},[s._v("576")]),n("br"),n("span",{staticClass:"line-number"},[s._v("577")]),n("br"),n("span",{staticClass:"line-number"},[s._v("578")]),n("br"),n("span",{staticClass:"line-number"},[s._v("579")]),n("br"),n("span",{staticClass:"line-number"},[s._v("580")]),n("br"),n("span",{staticClass:"line-number"},[s._v("581")]),n("br"),n("span",{staticClass:"line-number"},[s._v("582")]),n("br"),n("span",{staticClass:"line-number"},[s._v("583")]),n("br"),n("span",{staticClass:"line-number"},[s._v("584")]),n("br"),n("span",{staticClass:"line-number"},[s._v("585")]),n("br"),n("span",{staticClass:"line-number"},[s._v("586")]),n("br"),n("span",{staticClass:"line-number"},[s._v("587")]),n("br"),n("span",{staticClass:"line-number"},[s._v("588")]),n("br"),n("span",{staticClass:"line-number"},[s._v("589")]),n("br"),n("span",{staticClass:"line-number"},[s._v("590")]),n("br"),n("span",{staticClass:"line-number"},[s._v("591")]),n("br"),n("span",{staticClass:"line-number"},[s._v("592")]),n("br"),n("span",{staticClass:"line-number"},[s._v("593")]),n("br"),n("span",{staticClass:"line-number"},[s._v("594")]),n("br"),n("span",{staticClass:"line-number"},[s._v("595")]),n("br"),n("span",{staticClass:"line-number"},[s._v("596")]),n("br"),n("span",{staticClass:"line-number"},[s._v("597")]),n("br"),n("span",{staticClass:"line-number"},[s._v("598")]),n("br"),n("span",{staticClass:"line-number"},[s._v("599")]),n("br"),n("span",{staticClass:"line-number"},[s._v("600")]),n("br"),n("span",{staticClass:"line-number"},[s._v("601")]),n("br"),n("span",{staticClass:"line-number"},[s._v("602")]),n("br"),n("span",{staticClass:"line-number"},[s._v("603")]),n("br"),n("span",{staticClass:"line-number"},[s._v("604")]),n("br"),n("span",{staticClass:"line-number"},[s._v("605")]),n("br"),n("span",{staticClass:"line-number"},[s._v("606")]),n("br"),n("span",{staticClass:"line-number"},[s._v("607")]),n("br"),n("span",{staticClass:"line-number"},[s._v("608")]),n("br"),n("span",{staticClass:"line-number"},[s._v("609")]),n("br"),n("span",{staticClass:"line-number"},[s._v("610")]),n("br"),n("span",{staticClass:"line-number"},[s._v("611")]),n("br"),n("span",{staticClass:"line-number"},[s._v("612")]),n("br"),n("span",{staticClass:"line-number"},[s._v("613")]),n("br"),n("span",{staticClass:"line-number"},[s._v("614")]),n("br"),n("span",{staticClass:"line-number"},[s._v("615")]),n("br"),n("span",{staticClass:"line-number"},[s._v("616")]),n("br"),n("span",{staticClass:"line-number"},[s._v("617")]),n("br"),n("span",{staticClass:"line-number"},[s._v("618")]),n("br"),n("span",{staticClass:"line-number"},[s._v("619")]),n("br"),n("span",{staticClass:"line-number"},[s._v("620")]),n("br"),n("span",{staticClass:"line-number"},[s._v("621")]),n("br"),n("span",{staticClass:"line-number"},[s._v("622")]),n("br"),n("span",{staticClass:"line-number"},[s._v("623")]),n("br"),n("span",{staticClass:"line-number"},[s._v("624")]),n("br"),n("span",{staticClass:"line-number"},[s._v("625")]),n("br"),n("span",{staticClass:"line-number"},[s._v("626")]),n("br"),n("span",{staticClass:"line-number"},[s._v("627")]),n("br"),n("span",{staticClass:"line-number"},[s._v("628")]),n("br"),n("span",{staticClass:"line-number"},[s._v("629")]),n("br"),n("span",{staticClass:"line-number"},[s._v("630")]),n("br"),n("span",{staticClass:"line-number"},[s._v("631")]),n("br"),n("span",{staticClass:"line-number"},[s._v("632")]),n("br"),n("span",{staticClass:"line-number"},[s._v("633")]),n("br"),n("span",{staticClass:"line-number"},[s._v("634")]),n("br"),n("span",{staticClass:"line-number"},[s._v("635")]),n("br"),n("span",{staticClass:"line-number"},[s._v("636")]),n("br"),n("span",{staticClass:"line-number"},[s._v("637")]),n("br"),n("span",{staticClass:"line-number"},[s._v("638")]),n("br"),n("span",{staticClass:"line-number"},[s._v("639")]),n("br"),n("span",{staticClass:"line-number"},[s._v("640")]),n("br"),n("span",{staticClass:"line-number"},[s._v("641")]),n("br"),n("span",{staticClass:"line-number"},[s._v("642")]),n("br"),n("span",{staticClass:"line-number"},[s._v("643")]),n("br"),n("span",{staticClass:"line-number"},[s._v("644")]),n("br"),n("span",{staticClass:"line-number"},[s._v("645")]),n("br"),n("span",{staticClass:"line-number"},[s._v("646")]),n("br"),n("span",{staticClass:"line-number"},[s._v("647")]),n("br"),n("span",{staticClass:"line-number"},[s._v("648")]),n("br"),n("span",{staticClass:"line-number"},[s._v("649")]),n("br"),n("span",{staticClass:"line-number"},[s._v("650")]),n("br"),n("span",{staticClass:"line-number"},[s._v("651")]),n("br"),n("span",{staticClass:"line-number"},[s._v("652")]),n("br"),n("span",{staticClass:"line-number"},[s._v("653")]),n("br"),n("span",{staticClass:"line-number"},[s._v("654")]),n("br"),n("span",{staticClass:"line-number"},[s._v("655")]),n("br"),n("span",{staticClass:"line-number"},[s._v("656")]),n("br"),n("span",{staticClass:"line-number"},[s._v("657")]),n("br"),n("span",{staticClass:"line-number"},[s._v("658")]),n("br"),n("span",{staticClass:"line-number"},[s._v("659")]),n("br"),n("span",{staticClass:"line-number"},[s._v("660")]),n("br"),n("span",{staticClass:"line-number"},[s._v("661")]),n("br"),n("span",{staticClass:"line-number"},[s._v("662")]),n("br"),n("span",{staticClass:"line-number"},[s._v("663")]),n("br"),n("span",{staticClass:"line-number"},[s._v("664")]),n("br"),n("span",{staticClass:"line-number"},[s._v("665")]),n("br"),n("span",{staticClass:"line-number"},[s._v("666")]),n("br"),n("span",{staticClass:"line-number"},[s._v("667")]),n("br"),n("span",{staticClass:"line-number"},[s._v("668")]),n("br"),n("span",{staticClass:"line-number"},[s._v("669")]),n("br"),n("span",{staticClass:"line-number"},[s._v("670")]),n("br"),n("span",{staticClass:"line-number"},[s._v("671")]),n("br"),n("span",{staticClass:"line-number"},[s._v("672")]),n("br"),n("span",{staticClass:"line-number"},[s._v("673")]),n("br"),n("span",{staticClass:"line-number"},[s._v("674")]),n("br"),n("span",{staticClass:"line-number"},[s._v("675")]),n("br"),n("span",{staticClass:"line-number"},[s._v("676")]),n("br"),n("span",{staticClass:"line-number"},[s._v("677")]),n("br"),n("span",{staticClass:"line-number"},[s._v("678")]),n("br"),n("span",{staticClass:"line-number"},[s._v("679")]),n("br"),n("span",{staticClass:"line-number"},[s._v("680")]),n("br"),n("span",{staticClass:"line-number"},[s._v("681")]),n("br"),n("span",{staticClass:"line-number"},[s._v("682")]),n("br"),n("span",{staticClass:"line-number"},[s._v("683")]),n("br"),n("span",{staticClass:"line-number"},[s._v("684")]),n("br"),n("span",{staticClass:"line-number"},[s._v("685")]),n("br"),n("span",{staticClass:"line-number"},[s._v("686")]),n("br"),n("span",{staticClass:"line-number"},[s._v("687")]),n("br"),n("span",{staticClass:"line-number"},[s._v("688")]),n("br"),n("span",{staticClass:"line-number"},[s._v("689")]),n("br"),n("span",{staticClass:"line-number"},[s._v("690")]),n("br"),n("span",{staticClass:"line-number"},[s._v("691")]),n("br"),n("span",{staticClass:"line-number"},[s._v("692")]),n("br"),n("span",{staticClass:"line-number"},[s._v("693")]),n("br"),n("span",{staticClass:"line-number"},[s._v("694")]),n("br"),n("span",{staticClass:"line-number"},[s._v("695")]),n("br"),n("span",{staticClass:"line-number"},[s._v("696")]),n("br"),n("span",{staticClass:"line-number"},[s._v("697")]),n("br"),n("span",{staticClass:"line-number"},[s._v("698")]),n("br"),n("span",{staticClass:"line-number"},[s._v("699")]),n("br"),n("span",{staticClass:"line-number"},[s._v("700")]),n("br"),n("span",{staticClass:"line-number"},[s._v("701")]),n("br"),n("span",{staticClass:"line-number"},[s._v("702")]),n("br"),n("span",{staticClass:"line-number"},[s._v("703")]),n("br"),n("span",{staticClass:"line-number"},[s._v("704")]),n("br"),n("span",{staticClass:"line-number"},[s._v("705")]),n("br"),n("span",{staticClass:"line-number"},[s._v("706")]),n("br"),n("span",{staticClass:"line-number"},[s._v("707")]),n("br"),n("span",{staticClass:"line-number"},[s._v("708")]),n("br"),n("span",{staticClass:"line-number"},[s._v("709")]),n("br"),n("span",{staticClass:"line-number"},[s._v("710")]),n("br"),n("span",{staticClass:"line-number"},[s._v("711")]),n("br"),n("span",{staticClass:"line-number"},[s._v("712")]),n("br"),n("span",{staticClass:"line-number"},[s._v("713")]),n("br"),n("span",{staticClass:"line-number"},[s._v("714")]),n("br"),n("span",{staticClass:"line-number"},[s._v("715")]),n("br"),n("span",{staticClass:"line-number"},[s._v("716")]),n("br"),n("span",{staticClass:"line-number"},[s._v("717")]),n("br"),n("span",{staticClass:"line-number"},[s._v("718")]),n("br"),n("span",{staticClass:"line-number"},[s._v("719")]),n("br"),n("span",{staticClass:"line-number"},[s._v("720")]),n("br"),n("span",{staticClass:"line-number"},[s._v("721")]),n("br"),n("span",{staticClass:"line-number"},[s._v("722")]),n("br"),n("span",{staticClass:"line-number"},[s._v("723")]),n("br"),n("span",{staticClass:"line-number"},[s._v("724")]),n("br"),n("span",{staticClass:"line-number"},[s._v("725")]),n("br"),n("span",{staticClass:"line-number"},[s._v("726")]),n("br"),n("span",{staticClass:"line-number"},[s._v("727")]),n("br"),n("span",{staticClass:"line-number"},[s._v("728")]),n("br"),n("span",{staticClass:"line-number"},[s._v("729")]),n("br"),n("span",{staticClass:"line-number"},[s._v("730")]),n("br"),n("span",{staticClass:"line-number"},[s._v("731")]),n("br"),n("span",{staticClass:"line-number"},[s._v("732")]),n("br"),n("span",{staticClass:"line-number"},[s._v("733")]),n("br"),n("span",{staticClass:"line-number"},[s._v("734")]),n("br"),n("span",{staticClass:"line-number"},[s._v("735")]),n("br"),n("span",{staticClass:"line-number"},[s._v("736")]),n("br"),n("span",{staticClass:"line-number"},[s._v("737")]),n("br"),n("span",{staticClass:"line-number"},[s._v("738")]),n("br"),n("span",{staticClass:"line-number"},[s._v("739")]),n("br"),n("span",{staticClass:"line-number"},[s._v("740")]),n("br"),n("span",{staticClass:"line-number"},[s._v("741")]),n("br"),n("span",{staticClass:"line-number"},[s._v("742")]),n("br"),n("span",{staticClass:"line-number"},[s._v("743")]),n("br"),n("span",{staticClass:"line-number"},[s._v("744")]),n("br"),n("span",{staticClass:"line-number"},[s._v("745")]),n("br"),n("span",{staticClass:"line-number"},[s._v("746")]),n("br"),n("span",{staticClass:"line-number"},[s._v("747")]),n("br"),n("span",{staticClass:"line-number"},[s._v("748")]),n("br"),n("span",{staticClass:"line-number"},[s._v("749")]),n("br"),n("span",{staticClass:"line-number"},[s._v("750")]),n("br"),n("span",{staticClass:"line-number"},[s._v("751")]),n("br"),n("span",{staticClass:"line-number"},[s._v("752")]),n("br"),n("span",{staticClass:"line-number"},[s._v("753")]),n("br"),n("span",{staticClass:"line-number"},[s._v("754")]),n("br"),n("span",{staticClass:"line-number"},[s._v("755")]),n("br"),n("span",{staticClass:"line-number"},[s._v("756")]),n("br"),n("span",{staticClass:"line-number"},[s._v("757")]),n("br"),n("span",{staticClass:"line-number"},[s._v("758")]),n("br"),n("span",{staticClass:"line-number"},[s._v("759")]),n("br"),n("span",{staticClass:"line-number"},[s._v("760")]),n("br"),n("span",{staticClass:"line-number"},[s._v("761")]),n("br"),n("span",{staticClass:"line-number"},[s._v("762")]),n("br"),n("span",{staticClass:"line-number"},[s._v("763")]),n("br"),n("span",{staticClass:"line-number"},[s._v("764")]),n("br"),n("span",{staticClass:"line-number"},[s._v("765")]),n("br"),n("span",{staticClass:"line-number"},[s._v("766")]),n("br"),n("span",{staticClass:"line-number"},[s._v("767")]),n("br"),n("span",{staticClass:"line-number"},[s._v("768")]),n("br"),n("span",{staticClass:"line-number"},[s._v("769")]),n("br"),n("span",{staticClass:"line-number"},[s._v("770")]),n("br"),n("span",{staticClass:"line-number"},[s._v("771")]),n("br"),n("span",{staticClass:"line-number"},[s._v("772")]),n("br"),n("span",{staticClass:"line-number"},[s._v("773")]),n("br"),n("span",{staticClass:"line-number"},[s._v("774")]),n("br"),n("span",{staticClass:"line-number"},[s._v("775")]),n("br"),n("span",{staticClass:"line-number"},[s._v("776")]),n("br"),n("span",{staticClass:"line-number"},[s._v("777")]),n("br"),n("span",{staticClass:"line-number"},[s._v("778")]),n("br"),n("span",{staticClass:"line-number"},[s._v("779")]),n("br"),n("span",{staticClass:"line-number"},[s._v("780")]),n("br"),n("span",{staticClass:"line-number"},[s._v("781")]),n("br"),n("span",{staticClass:"line-number"},[s._v("782")]),n("br"),n("span",{staticClass:"line-number"},[s._v("783")]),n("br"),n("span",{staticClass:"line-number"},[s._v("784")]),n("br")])]),n("ul",[n("li",[s._v("在每台服务器上安装K3S")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INSTALL_K3S_SKIP_DOWNLOAD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INSTALL_K3S_EXEC")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'server --datastore-endpoint="mysql://root:root@tcp(10.1.103.171:3306)/k3s" --docker --pause-image="microid.docker.com:5000/rancher/pause:3.1"\'')]),s._v(" ./install.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("在每个worker节点上安装k3s")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INSTALL_K3S_SKIP_DOWNLOAD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INSTALL_K3S_EXEC")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'agent --datastore-endpoint="mysql://root:root@tcp(10.1.103.171:3306)/k3s" --docker --pause-image="microid.docker.com:5000/rancher/pause:3.1"\'')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("K3S_URL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://myserver:6443 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("K3S_TOKEN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mynodetoken ./install.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("blockquote",[n("p",[n("strong",[s._v("注意")]),s._v(" 请确保用服务器的"),n("code",[s._v("IP或有效DNS")]),s._v("替换"),n("code",[s._v("myserver")]),s._v(",并用服务器的节点令牌替换"),n("code",[s._v("mynodetoken")]),s._v("。节点令牌位于服务器的"),n("code",[s._v("/var/lib/rancher/k3s/server/node-token")]),s._v("。")])]),s._v(" "),n("blockquote",[n("p",[n("strong",[s._v("注意：")]),s._v(" 如果k3s使用外部mysql连接，可能由于k3s这里拼接mysql地址会出现反斜杠"),n("code",[s._v("\\")]),s._v(" ，导致链接失败现象，所以需要手动修改 "),n("code",[s._v("/etc/systemd/system/k3s.service")]),s._v(" 文件，将 "),n("code",[s._v("\\")]),s._v(" 删掉，如下图所示。")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(488),alt:"image-20200526174934213"}})]),s._v(" "),n("h3",{attrs:{id:"_4、检测"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4、检测"}},[s._v("#")]),s._v(" 4、检测")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods --all-namespaces #查看pod，状态正常即可")]),s._v("\nNAMESPACE           NAME                                                       READY   STATUS             RESTARTS   AGE\ndefault             elk-f6df9c564-4whhz                                        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          10d\nkube-system         metrics-server-7566d596c8-lgjmt                            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          10d\ncattle-prometheus   prometheus-operator-monitoring-operator-695b9b7d89-tp4qs   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          10d\ncattle-prometheus   exporter-kube-state-cluster-monitoring-f8cfddbbb-7d2sn     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          10d\nkube-system         coredns-8655855d6-stfqs                                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          10d\nagilefast-clound    cms-vue-57c5b55b48-t4hkn                                   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          10d\ncattle-system       rancher-ddb6db556-mbv45                                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("          10d\nagilefast-clound    agilefast-sentinel-dashboard-65fdfc4d7c-nkz88              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          10d\nkube-system         svclb-traefik-gn6qr                                        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("          163d\ncattle-system       cattle-cluster-agent-6666b6b47f-nlk9d                      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v("         162d\ncattle-system       cattle-node-agent-p9zgg                                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("         162d\ncattle-prometheus   exporter-node-cluster-monitoring-d54sr                     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("          162d\ncattle-prometheus   prometheus-cluster-monitoring-0                            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/5     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          10d\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get node #获取node 节点")]),s._v("\nNAME    STATUS   ROLES    AGE    VERSION\nnode1   Ready    master   163d   v1.18.2-rc2+k3s1\nnode2   Ready    master   163d   v1.18.2-rc2+k3s1\nnode5   Ready    master   43d    v1.18.2-rc2+k3s1\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);