(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{538:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"rancher-k3s安装环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rancher-k3s安装环境准备"}},[s._v("#")]),s._v(" Rancher+K3s安装环境准备")]),s._v(" "),a("blockquote",[a("p",[s._v("这里通过K3s高可用集群安装。")])]),s._v(" "),a("h3",{attrs:{id:"一-基础设施"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-基础设施"}},[s._v("#")]),s._v(" (一)基础设施")]),s._v(" "),a("blockquote",[a("p",[s._v("参考"),a("a",{attrs:{href:"https://docs.rancher.cn/docs/rancher2/installation/requirements/_index",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网文档"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("在 K3s 集群中安装 Rancher 高可用，我们建议为高可用安装配置以下基础设施：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("2 个 Linux 节点")]),s._v("，通常是虚拟机，您可以自行选择的基础设施提供商，例如 Amazon EC2，阿里云，腾讯云或者 vShpere 等。")]),s._v(" "),a("li",[a("strong",[s._v("1 个外置数据库")]),s._v("，用于存储集群数据。我们建议使用 MySQL。")]),s._v(" "),a("li",[a("strong",[s._v("1 个负载均衡器")]),s._v("，用于将流量转发到这两个节点。")]),s._v(" "),a("li",[a("strong",[s._v("一条 DNS 记录")]),s._v("，用于将 URL 指向负载均衡器。这将成为 Rancher Server 的 URL，下游集群需要可以访问到这个地址。")])]),s._v(" "),a("h4",{attrs:{id:"_1、配置linux节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、配置linux节点"}},[s._v("#")]),s._v(" 1、"),a("strong",[s._v("配置Linux节点")])]),s._v(" "),a("h5",{attrs:{id:"_1-操作系统和容器运行时要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-操作系统和容器运行时要求"}},[s._v("#")]),s._v(" 1.  "),a("strong",[s._v("操作系统和容器运行时要求")])]),s._v(" "),a("p",[s._v("Rancher 应用可以兼容当前任何流行的 Linux 发行版。")]),s._v(" "),a("p",[s._v("Rancher 官方支持并且已在如下操作系统中测试了 Rancher 和 RKE，它们包括 Ubuntu，CentOS，Oracle Linux，RancherOS 和 RedHat Enterprise Linux")]),s._v(" "),a("p",[s._v("K3s 几乎可以在任何 Linux 版本上运行。K3s 在以下操作系统及其这些版本后续的非主要版本中进行了测试：")]),s._v(" "),a("ul",[a("li",[s._v("Ubuntu 16.04 (amd64)")]),s._v(" "),a("li",[s._v("Ubuntu 18.04 (amd64)")]),s._v(" "),a("li",[s._v("Raspbian Buster (armhf)")])]),s._v(" "),a("h5",{attrs:{id:"_2-安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装docker"}},[s._v("#")]),s._v(" 2.  "),a("strong",[s._v("安装Docker")])]),s._v(" "),a("p",[s._v("可以按照"),a("a",{attrs:{href:"https://docs.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 官方文档"),a("OutboundLink")],1),s._v("中的步骤安装 Docker。")]),s._v(" "),a("h5",{attrs:{id:"_3-k3s高可用安装的cpu和内容要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-k3s高可用安装的cpu和内容要求"}},[s._v("#")]),s._v(" 3.  "),a("strong",[s._v("K3s高可用安装的CPU和内容要求")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("部署规模")]),s._v(" "),a("th",[s._v("集群")]),s._v(" "),a("th",[s._v("节点")]),s._v(" "),a("th",[s._v("vCPUs")]),s._v(" "),a("th",[s._v("内存")]),s._v(" "),a("th",[s._v("数据库规模")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("小")]),s._v(" "),a("td",[s._v("最多 150 个")]),s._v(" "),a("td",[s._v("最多 1500 个")]),s._v(" "),a("td",[s._v("2")]),s._v(" "),a("td",[s._v("8 GB")]),s._v(" "),a("td",[s._v("2 cores, 4GB + 1000 IOPS")])]),s._v(" "),a("tr",[a("td",[s._v("中")]),s._v(" "),a("td",[s._v("最多 300 个")]),s._v(" "),a("td",[s._v("最多 3000 个")]),s._v(" "),a("td",[s._v("4")]),s._v(" "),a("td",[s._v("16 GB")]),s._v(" "),a("td",[s._v("2 cores, 4GB + 1000 IOPS")])]),s._v(" "),a("tr",[a("td",[s._v("大")]),s._v(" "),a("td",[s._v("最多 500 个")]),s._v(" "),a("td",[s._v("最多 5000 个")]),s._v(" "),a("td",[s._v("8")]),s._v(" "),a("td",[s._v("32 GB")]),s._v(" "),a("td",[s._v("2 cores, 4GB + 1000 IOPS")])]),s._v(" "),a("tr",[a("td",[s._v("特大")]),s._v(" "),a("td",[s._v("最多 1000 个")]),s._v(" "),a("td",[s._v("最多 10,000 个")]),s._v(" "),a("td",[s._v("16")]),s._v(" "),a("td",[s._v("64 GB")]),s._v(" "),a("td",[s._v("2 cores, 4GB + 1000 IOPS")])]),s._v(" "),a("tr",[a("td",[s._v("超大")]),s._v(" "),a("td",[s._v("最多 2000 个")]),s._v(" "),a("td",[s._v("最多 20,000 个")]),s._v(" "),a("td",[s._v("32")]),s._v(" "),a("td",[s._v("128 GB")]),s._v(" "),a("td",[s._v("2 cores, 4GB + 1000 IOPS")])])])]),s._v(" "),a("h5",{attrs:{id:"_4-k3s高可用安装的端口要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-k3s高可用安装的端口要求"}},[s._v("#")]),s._v(" 4.  "),a("strong",[s._v("K3s高可用安装的端口要求")])]),s._v(" "),a("p",[s._v("下图描述了为每种"),a("a",{attrs:{href:"https://docs.rancher.cn/docs/rancher2/cluster-provisioning/_index",target:"_blank",rel:"noopener noreferrer"}},[s._v("集群类型"),a("OutboundLink")],1),s._v("开放的端口。")]),s._v(" "),a("p",[s._v("Rancher 管理面的端口要求")]),s._v(" "),a("p",[a("img",{attrs:{src:"img/port-communications.svg",alt:"Basic Port Requirements"}})]),s._v(" "),a("p",[s._v("下表细分了入站和出站流量的端口要求：")]),s._v(" "),a("p",[s._v("Rancher 节点的入站规则")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("协议")]),s._v(" "),a("th",[s._v("端口")]),s._v(" "),a("th",[s._v("源")]),s._v(" "),a("th",[s._v("描述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("80")]),s._v(" "),a("td",[s._v("进行外部 SSL 终止的负载均衡器/代理")]),s._v(" "),a("td",[s._v("使用外部 SSL 终止时的 Rancher UI/API")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("443")]),s._v(" "),a("td",[s._v("etcd 节点controlplane 节点worker 节点托管的/导入的 Kubernetes任何需要使用 Rancher UI 或 API 的源")]),s._v(" "),a("td",[s._v("Rancher Agent，Rancher UI/API，kubectl")])])])]),s._v(" "),a("p",[s._v("Rancher 节点的出站规则")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("协议")]),s._v(" "),a("th",[s._v("端口")]),s._v(" "),a("th",[s._v("目的")]),s._v(" "),a("th",[s._v("描述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("22")]),s._v(" "),a("td",[s._v("使用主机驱动创建的节点中的任何节点 IP")]),s._v(" "),a("td",[s._v("使用主机驱动通过 SSH 进行节点配置")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("443")]),s._v(" "),a("td",[a("code",[s._v("35.160.43.145/32")]),s._v("，"),a("code",[s._v("35.167.242.46/32")]),s._v("，"),a("code",[s._v("52.33.59.17/32")])]),s._v(" "),a("td",[s._v("git.rancher.io (应用商店)")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("2376")]),s._v(" "),a("td",[s._v("使用主机驱动创建的节点中的任何节点 IP")]),s._v(" "),a("td",[s._v("Docker Machine 使用的 Docker 守护进程的 TLS 端口")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("6443")]),s._v(" "),a("td",[s._v("托管的/导入的 Kubernetes API")]),s._v(" "),a("td",[s._v("Kubernetes API Server")])])])]),s._v(" "),a("blockquote",[a("p",[s._v("注:由于生产环境原因,防火墙不能关闭,这里我除了上面的端口为,开启了2000-60000的端口")])]),s._v(" "),a("h4",{attrs:{id:"_2、配置外部数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、配置外部数据库"}},[s._v("#")]),s._v(" 2、"),a("strong",[s._v("配置外部数据库")])]),s._v(" "),a("p",[s._v("对于高可用 K3s 安装，您将需要配置一个外部 "),a("a",{attrs:{href:"https://www.mysql.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL"),a("OutboundLink")],1),s._v(" 数据库。我们已经针对 MySQL 5.7 版本对 K3s Kubernetes 集群进行了测试。")]),s._v(" "),a("h4",{attrs:{id:"_3、配置负载均衡器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、配置负载均衡器"}},[s._v("#")]),s._v(" 3、"),a("strong",[s._v("配置负载均衡器")])]),s._v(" "),a("p",[s._v("Rancher 需要配置一个负载均衡器，可以将流量定向到两个节点上的 Rancher 副本。这样可以在单个节点不可用时，继续保障与 Rancher 管理面的连接。")]),s._v(" "),a("p",[s._v("在后续步骤中配置 Kubernetes 时，K3s 工具将部署 Traefik Ingress 控制器。该控制器将侦听 worker 节点的 80 端口和 443 端口，以响应发送给特定主机名的流量。")]),s._v(" "),a("p",[s._v("在安装 Rancher 时（也是在后续步骤中），Rancher 系统将创建一个 Ingress 资源。该 Ingress 通知 Traefik Ingress 控制器侦听发往 Rancher 主机名的流量。Traefik Ingress 控制器在收到发往 Rancher 主机名的流量时，会将其转发到集群中正在运行的 Rancher Server Pod。")]),s._v(" "),a("p",[s._v("这里使用"),a("strong",[s._v("4层负载均衡器")])]),s._v(" "),a("p",[a("strong",[s._v("4 层负载均衡器")]),s._v(" 是两种选择中相对简单的一种，它将 TCP 流量转发到您到节点。我们建议使用 4 层负载均衡器，将流量从 TCP / 80 端口和 TCP / 443 端口转发到 Rancher 管理面的集群节点上。集群上的 Ingress 控制器会将 HTTP 流量重定向到 HTTPS，并在 TCP / 443 端口上终止 SSL / TLS。Ingress 控制器会将流量转发到 Rancher Server Pod 的 TCP / 443 端口。")]),s._v(" "),a("p",[a("strong",[s._v("配置NGINX负载均衡")])]),s._v(" "),a("p",[s._v("使用 NGINX 作为"),a("code",[s._v("L4")]),s._v("层负载均衡器(TCP)，它将请求轮训转发到后端的 Rancher server 节点。在此配置中，负载均衡器位于 Rancher server 节点的前面。负载均衡器可以是任何能够运行 NGINX 的主机。")]),s._v(" "),a("p",[s._v("这里将NGINX作为Dokcer容器运行，新建"),a("code",[s._v("nginx.conf")]),s._v("文件，写入下面内容")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_rlimit_nofile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nstream "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" rancher_servers_http "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        least_conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".103")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".171")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".103")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".172")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".103")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".173")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" rancher_servers_http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" rancher_servers_https "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        least_conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".103")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".171")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".103")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".172")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".103")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".173")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" rancher_servers_https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" k3s_servers_https "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        least_conn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".103")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".171")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".103")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".172")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".103")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".173")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" k3s_servers_https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("p",[s._v("启动命令")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ docker run -d --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unless-stopped "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(":443 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /etc/nginx.conf:/etc/nginx/nginx.conf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    nginx:1.14\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_4、配置dns记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、配置dns记录"}},[s._v("#")]),s._v(" 4、"),a("strong",[s._v("配置DNS记录")])]),s._v(" "),a("p",[s._v("参考"),a("RouterLink",{attrs:{to:"/docs/运维系列/DNS系列/Window服务器搭建DNS服务器.html"}},[s._v("Window服务器搭建DNS服务器")]),s._v("文档，配置DNS域名解析，这里配置的域名为"),a("code",[s._v("rancher.agilefast.com")]),s._v(",域名指向上一步的负载均衡器主机。")],1),s._v(" "),a("h4",{attrs:{id:"_5、配置ntp时间同步服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、配置ntp时间同步服务器"}},[s._v("#")]),s._v(" 5、配置NTP时间同步服务器")]),s._v(" "),a("h5",{attrs:{id:"_1、ntp服务的安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、ntp服务的安装"}},[s._v("#")]),s._v(" 1、NTP服务的安装")]),s._v(" "),a("h6",{attrs:{id:"_1-1-查看系统是否已经安装ntp服务组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-查看系统是否已经安装ntp服务组件"}},[s._v("#")]),s._v(" 1.1 查看系统是否已经安装ntp服务组件")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -qa|grep ntp")]),s._v("\nntp-4.2.6p5-29.el7.centos.x86_64\nfontpackages-filesystem-1.44-8.el7.noarch\nntpdate-4.2.6p5-29.el7.centos.x86_64\npython-ntplib-0.3.2-1.el7.noarch\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /etc|grep ntp")]),s._v("\nntp\nntp.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("存在说明服务器已经安装了ntp sever.直接跳过安装，到服务配置.")]),s._v(" "),a("h6",{attrs:{id:"_1-2-在线安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-在线安装"}},[s._v("#")]),s._v(" 1.2 在线安装")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum -y install ntp")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h6",{attrs:{id:"_1-3-离线安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-离线安装"}},[s._v("#")]),s._v(" 1.3 离线安装")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者，找一台本地可联网服务器，进行安装包的download")]),s._v("\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ntp --downloadonly --downloaddir /root/ntp\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入rpm包安装目录，执行如下命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh *.rpm --force --nodeps\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置开机启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#chkconfig ntpd on")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" ntpd  \n \nsystemctl start ntpd\n \nsystemctl status ntpd\n \nsystemctl daemon-reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h6",{attrs:{id:"_1-4-服务配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-服务配置"}},[s._v("#")]),s._v(" 1.4 服务配置")]),s._v(" "),a("p",[s._v("在离线环境下，使用本服务器的时间做为时间同步")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/ntp.conf")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server 0.centos.pool.ntp.org iburst")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server 1.centos.pool.ntp.org iburst")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server 2.centos.pool.ntp.org iburst")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server 3.centos.pool.ntp.org iburst")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.127")]),s._v(".1.0 iburst  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加这一行，注销到上边的内容")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h5",{attrs:{id:"_2、ntp客户端同步配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、ntp客户端同步配置"}},[s._v("#")]),s._v(" 2、NTP客户端同步配置")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/ntp.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server 0.centos.pool.ntp.org iburst")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server 1.centos.pool.ntp.org iburst")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server 2.centos.pool.ntp.org iburst")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server 3.centos.pool.ntp.org iburst")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果联不通外网，则把上面几行注释，然后添加下面两行，意思是设置成时间服务器是自己")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".250.114\nfudge "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".250.114 stratum "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart ntpd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ntpdate -u 10.107.250.114  # 同步服务器时间")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":22:30 ntpdate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1143")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": step "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".250.114 offset "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59.282628")]),s._v(" sec\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# date")]),s._v("\nThu Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":22:33 CST "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("查看时间是否同步")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CCRNode2 docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ntpq -p")]),s._v("\n     remote           refid      st t when poll reach   delay   offset  jitter\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".250.114  LOCAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" u  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("178")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.758")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59282.3")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_6、docker私有仓库搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、docker私有仓库搭建"}},[s._v("#")]),s._v(" 6、Docker私有仓库搭建")]),s._v(" "),a("p",[s._v("参考"),a("RouterLink",{attrs:{to:"/docs/运维系列/Docker系列/Docker私有仓库.html"}},[s._v("Docker私有仓库搭建文档")])],1),s._v(" "),a("h3",{attrs:{id:"二-同步镜像到私有仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-同步镜像到私有仓库"}},[s._v("#")]),s._v(" (二)同步镜像到私有仓库")]),s._v(" "),a("p",[s._v("默认情况下，Rancher中所有用于创建Kubernets集群或运行任何工具的镜像都是从Docker Hub中拉去，如： 监控、日志、告警、流水线等镜像。在离线环境下安装Rancher，需要一个私有镜像库，这个私有镜像库应该位于Rancher中的任意节点能访问的位置上。")]),s._v(" "),a("blockquote",[a("p",[s._v("注意：安装Docker私有仓库参照"),a("RouterLink",{attrs:{to:"/docs/运维系列/rancher-series/Docker私有仓库.html"}},[s._v("Docker私有仓库")]),s._v("，这里只描述在Linux节点下的镜像同步，其它内容，参照"),a("a",{attrs:{href:"https://docs.rancher.cn/docs/rancher2/installation/other-installation-methods/air-gap/populate-private-registry/_index",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网文档"),a("OutboundLink")],1),s._v("。")],1)]),s._v(" "),a("p",[s._v("对于仅有Linux节点的集群，按照以下步骤推送镜像到私有镜像库。")]),s._v(" "),a("ol",[a("li",[s._v("查找 Rancher 版本所需要的资源")]),s._v(" "),a("li",[s._v("将镜像保存到本地")]),s._v(" "),a("li",[s._v("推送镜像到私有镜像库")])]),s._v(" "),a("h4",{attrs:{id:"_1、查找-rancher-版本所需要的资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、查找-rancher-版本所需要的资源"}},[s._v("#")]),s._v(" 1、查找 Rancher 版本所需要的资源")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("浏览Rancher的"),a("a",{attrs:{href:"https://github.com/rancher/rancher/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("版本发布页面"),a("OutboundLink")],1),s._v("，查找您想安装的 Rancher v2.x.x 版本。不要下载标记为 "),a("code",[s._v("rc")]),s._v(" 或 "),a("code",[s._v("Pre-release")]),s._v(" 的版本，因为它们在生产环境下是不稳定的。")])]),s._v(" "),a("li",[a("p",[s._v("从发行版 "),a("strong",[s._v("Assets")]),s._v(" 部分下载以下文件，这些文件是离线环境下安装 Rancher 所必需的：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("Release 文件")]),s._v(" "),a("th",[s._v("描述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[a("code",[s._v("rancher-images.txt")])]),s._v(" "),a("td",[s._v("此文件包含安装 Rancher、创建集群和运行 Rancher 工具所需的镜像列表。")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("rancher-save-images.sh")])]),s._v(" "),a("td",[s._v("这个脚本会从 DockerHub 中拉取在文件"),a("code",[s._v("rancher-images.txt")]),s._v("中描述的所有镜像，并将它们保存为文件"),a("code",[s._v("rancher-images.tar.gz")]),s._v("。")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("rancher-load-images.sh")])]),s._v(" "),a("td",[s._v("这个脚本会载入文件"),a("code",[s._v("rancher-images.tar.gz")]),s._v("中的镜像，并将它们推送到您自己的私有镜")])])])]),s._v(" "),a("p",[s._v("这里安装的是Rancher 2.3.6版本。")])])]),s._v(" "),a("h4",{attrs:{id:"_2、将镜像保存到本地"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、将镜像保存到本地"}},[s._v("#")]),s._v(" 2、将镜像保存到本地")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("为"),a("code",[s._v("rancher-save-images.sh")]),s._v(" 文件添加可执行权限：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x rancher-save-images.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("执行脚本"),a("code",[s._v("rancher-save-images.sh")]),s._v("并以"),a("code",[s._v("--image-list ./rancher-images.txt")]),s._v(" 作为参数，创建所有需要镜像的压缩包：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("./rancher-save-images.sh --image-list ./rancher-images.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("结果：")]),s._v(" Docker 会开始拉取用于离线安装所需的镜像。这个过程会花费几分钟时间。完成时，您的当前目录会输出名为"),a("code",[s._v("rancher-images.tar.gz")]),s._v("的压缩包。请确认输出文件是否存在。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"img/image-20201012100339139.png",alt:"image-20201012100339139"}})])])]),s._v(" "),a("h4",{attrs:{id:"_3、推送镜像到私有镜像库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、推送镜像到私有镜像库"}},[s._v("#")]),s._v(" 3、推送镜像到私有镜像库")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("为 "),a("code",[s._v("rancher-load-images.sh")]),s._v(" 添加可执行权限：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x rancher-load-images.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("使用脚本 "),a("code",[s._v("rancher-load-images.sh")]),s._v("提取"),a("code",[s._v("rancher-images.tar.gz")]),s._v("文件中的镜像，根据文件"),a("code",[s._v("rancher-images.txt")]),s._v("中的镜像列表对提取的镜像文件重新打 tag 并推送到您的私有镜像库：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("./rancher-load-images.sh --image-list ./rancher-images.txt --registry "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("REGISTRY.YOURDOMAIN.COM:PORT"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);