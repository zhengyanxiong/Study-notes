(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{533:function(t,s,a){"use strict";a.r(s);var e=a(4),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"通过docker和cri-dockerd部署k8s-1-24"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过docker和cri-dockerd部署k8s-1-24"}},[t._v("#")]),t._v(" 通过docker和cri-dockerd部署K8s 1.24")]),t._v(" "),a("blockquote",[a("p",[t._v("部署文档参照官网https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/")])]),t._v(" "),a("h3",{attrs:{id:"_1-环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境准备"}},[t._v("#")]),t._v(" 1.环境准备")]),t._v(" "),a("h4",{attrs:{id:"_1-1-主机操作系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-主机操作系统"}},[t._v("#")]),t._v(" 1.1 主机操作系统")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("序号")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("操作系统及版本")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("备注")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("CentOS Linux release 7.9.2009 (Core)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})])])]),t._v(" "),a("h4",{attrs:{id:"_1-2-k8s主机规划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-k8s主机规划"}},[t._v("#")]),t._v(" 1.2 k8s主机规划")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("主机名")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("IP地址")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("CPU")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("内存")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("硬盘")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("角色")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("vrm01")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.0.104")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("4核")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("3G")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("40G")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("master")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("vrm02")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.0.106")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2核")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2G")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("40G")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("node")])])])]),t._v(" "),a("h4",{attrs:{id:"_1-3-安装前准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-安装前准备"}},[t._v("#")]),t._v(" 1.3 安装前准备")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("关闭swap分区")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#临时关闭")]),t._v("\n$ swapoff -a\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#永远关闭swap分区，需要重启操作系统")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/ swap / s/^\\(.*\\)$/#"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\1"}},[t._v("\\1")]),t._v("/g'")]),t._v(" /etc/fstab\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("关闭防火墙")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ systemctl disable firewalld\n$ systemctl stop firewalld\n$ firewall-cmd --state\nnot running\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("关闭SELINUX配置")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#临时关闭")]),t._v("\n$ setenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#永久生效")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -ri "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/SELINUX=enforcing/SELINUX=disabled/'")]),t._v(" /etc/selinux/config\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("docker 安装参照 [Centos安装Docker]: ../Centos安装Docker.md")])])]),t._v(" "),a("h3",{attrs:{id:"_2-kubeadm安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-kubeadm安装"}},[t._v("#")]),t._v(" 2. Kubeadm安装")]),t._v(" "),a("h4",{attrs:{id:"_2-1-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装"}},[t._v("#")]),t._v(" 2.1 安装")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置阿里yum源 https://developer.aliyun.com/mirror/kubernetes/?spm=a2c6h.25603864.0.0.5a1c274fjiq5U9")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/yum.repos.d/kubernetes.repo")]),t._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("blockquote",[a("p",[t._v("ps: 由于官网未开放同步方式, 可能会有索引gpg检查失败的情况, 这时请用 "),a("code",[t._v("yum install -y --nogpgcheck kubelet kubeadm kubectl")]),t._v(" 安装")])]),t._v(" "),a("h4",{attrs:{id:"_2-2-设置开启自启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-设置开启自启动"}},[t._v("#")]),t._v(" 2.2 设置开启自启动")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" kubelet "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" systemctl start kubelet\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2-3-获取默认的参数化文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-获取默认的参数化文件"}},[t._v("#")]),t._v(" 2.3 获取默认的参数化文件")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ kubeadm config print init-defaults "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" init.default.ymal\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2-4-配置kublet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-配置kublet"}},[t._v("#")]),t._v(" 2.4 配置kublet")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/sysconfig/kubelet")]),t._v('\nKUBELET_EXTRA_ARGS="--cgroup-driver=systemd"\nEOF')]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h4",{attrs:{id:"_2-5-初始化配置文件-只在主节点执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-初始化配置文件-只在主节点执行"}},[t._v("#")]),t._v(" 2.5 初始化配置文件 "),a("em",[a("strong",[t._v("只在主节点执行")])])]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bootstrapTokens")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("groups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("bootstrappers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("kubeadm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("token")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" abcdef.0123456789abcdef\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ttl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 24h0m0s\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("usages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" signing\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" authentication\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" InitConfiguration\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localAPIEndpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("advertiseAddress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.0.104 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置主机ip地址")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bindPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeRegistration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("criSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" unix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("///var/run/cri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dockerd.sock "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置cri")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IfNotPresent\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置主节点名称")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("taints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeoutForControlPlane")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4m0s\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("certificatesDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kubernetes/pki\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("controllerManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("etcd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dataDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/etcd\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageRepository")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry.aliyuncs.com/google_containers "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置成阿里云镜像仓")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterConfiguration\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetesVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1.24.4\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networking")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dnsDomain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster.local\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceSubnet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.96.0.0/12\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scheduler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" KubeletConfiguration  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置systemd")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubelet.config.k8s.io/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cgroupDriver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" systemd\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br")])]),a("h4",{attrs:{id:"_2-6-获取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-获取镜像"}},[t._v("#")]),t._v(" 2.6 获取镜像")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ kubeadm config images pull --config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("init.default.ymal\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2-7-安装k8s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-安装k8s"}},[t._v("#")]),t._v(" 2.7 安装k8s")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("kubeadm init --config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("init.default.ymal\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("blockquote",[a("p",[t._v("kubeadm join 192.168.0.104:6443 --token abcdef.0123456789abcdef "),a("br"),t._v("\n--discovery-token-ca-cert-hash sha256:458a5fa2b1aaf19b9a445c2d0964312b37c055567b78a611b3577184f38dd6a5 --cri-socket unix:///var/run/cri-dockerd.sock")])]),t._v(" "),a("h4",{attrs:{id:"_2-8-如果init失败后使用-kubead-reset恢复系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-8-如果init失败后使用-kubead-reset恢复系统"}},[t._v("#")]),t._v(" 2.8 如果init失败后使用 kubead reset恢复系统")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ kubeadm reset\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除相关资源")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf /etc/cni /etc/kubernetes /var/lib/dockershim /var/lib/etcd /var/lib/kubelet /var/run/kubernetes ~/.kube/*\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 恢复iptables")]),t._v("\n$ iptables -F "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -X\n$ iptables -t nat -F "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -t nat -X\n$ iptables -t raw -F "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -t raw -X\n$ iptables -t mangle -F "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iptables -t mangle -X\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h4",{attrs:{id:"_2-9-安装网络插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-9-安装网络插件"}},[t._v("#")]),t._v(" 2.9 安装网络插件")]),t._v(" "),a("blockquote",[a("p",[t._v("k8s网络插件有许多https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/addons/#networking-and-network-policy，这里选择weave插件")])]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 通过命令安装")]),t._v("\n$  kubectl apply -f "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://cloud.weave.works/k8s/net?k8s-version='),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl version "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" base64 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tr")]),t._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v("'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("这里由于本地拉取weave镜像失败，列出定位问题的过程")]),t._v(" "),a("p",[t._v("执行命令一段时候后，查看pod状态，发现weave pod获取镜像失败")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zhengyanxiong/picture-bed/raw/master/img/image-20220824220923147.png",alt:"image-20220824220923147"}})]),t._v(" "),a("p",[t._v("这时是查看pod日志是看不到什么内容的，显示如下图")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zhengyanxiong/picture-bed/raw/master/img/image-20220824221119591.png",alt:"image-20220824221119591"}})]),t._v(" "),a("p",[t._v("可以导出wave-net-fxp2s pod的yaml文件，来看该镜像的具体版本信息")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zhengyanxiong/picture-bed/raw/master/img/image-20220824221255083.png",alt:"image-20220824221255083"}})]),t._v(" "),a("p",[t._v("然后手动拉去对应的镜像及版本")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zhengyanxiong/picture-bed/raw/master/img/image-20220824221354423.png",alt:"image-20220824221354423"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zhengyanxiong/picture-bed/raw/master/img/image-20220824221449770.png",alt:"image-20220824221449770"}})]),t._v(" "),a("p",[t._v("完成后，查看k8s集群信息，恢复正常")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zhengyanxiong/picture-bed/raw/master/img/image-20220824221549798.png",alt:"image-20220824221549798"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);